<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Prompt Profesional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6', // Blue
                        secondary: '#1E40AF',
                        accent: '#60A5FA',
                        dark: '#1F2937',
                        light: '#F9FAFB', 
                        purple: {
                            DEFAULT: '#8B5CF6',
                            dark: '#7C3AED',
                            light: '#A78BFA',
                        },
                        orange: {
                            DEFAULT: '#F97316',
                            dark: '#EA580C',
                        },
                        green: {
                            DEFAULT: '#22C55E',
                            dark: '#16A34A',
                            light: '#DCFCE7'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); border: 1px solid rgba(209, 213, 219, 0.3); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); }
        .input-field, .select-field { transition: all 0.3s ease; border-color: #D1D5DB; }
        .input-field:focus, .select-field:focus { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1); border-color: #3B82F6; ring-width: 1px; ring-color: #3B82F6; }
        .form-category-title { font-size: 1.125rem; font-weight: 600; color: #374151; padding-bottom: 0.5rem; border-bottom: 1px solid #E5E7EB; margin-bottom: 1rem; }
        #generatedPrompt::-webkit-scrollbar, #generatedPromptEnglish::-webkit-scrollbar { width: 6px; }
        #generatedPrompt::-webkit-scrollbar-track, #generatedPromptEnglish::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        #generatedPrompt::-webkit-scrollbar-thumb, #generatedPromptEnglish::-webkit-scrollbar-thumb { background: #a8a29e; border-radius: 3px; }
        #generatedPrompt::-webkit-scrollbar-thumb:hover, #generatedPromptEnglish::-webkit-scrollbar-thumb:hover { background: #78716c; }
        .range-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #8B5CF6; cursor: pointer; border-radius: 50%; }
        .range-slider::-moz-range-thumb { width: 16px; height: 16px; background: #8B5CF6; cursor: pointer; border-radius: 50%; border: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        button:disabled { background-color: #9CA3AF !important; border-color: #9CA3AF !important; color: #E5E7EB !important; cursor: not-allowed !important; }
        button:disabled:hover { background-color: #9CA3AF !important; }
    </style>
</head>
<body class="font-sans text-gray-800">
    <div class="container mx-auto px-4 py-8">

        <div class="max-w-4xl mx-auto mb-6 p-4 border border-gray-200 rounded-lg shadow-sm bg-white">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center">
                    <svg id="apiKeyStatusIcon" class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h2 class="text-md font-semibold text-gray-700">Status API Key Gemini</h2>
                </div>
                <span id="apiKeyStatusText" class="text-xs text-red-700 bg-red-100 px-2 py-1 rounded-full font-medium border border-red-300">Belum Diatur</span>
            </div>
            <p id="apiKeyInfoText" class="text-sm text-gray-600 mb-3">
                Generator memerlukan API Key Gemini untuk berfungsi. Silakan atur API Key Anda.
            </p>
            <div class="mt-4">
                <button id="setupApiKeyButton" class="w-full sm:w-auto flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md border border-green-600 text-green-700 hover:bg-green-50 transition-colors duration-150">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H5v-2H3v-2H1v-4a6 6 0 016-6h7zm0 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v2m0 0h2m0 0h2m0 0h2m0 0h2"></path></svg>
                    <span id="setupApiKeyButtonText">Setup API Key</span>
                </button>
            </div>
        </div>
        
        <div class="max-w-7xl mx-auto flex flex-col lg:flex-row gap-6">
            <div class="flex-1">
                <div class="bg-gradient-to-r from-purple-600 to-pink-500 p-4 rounded-t-xl flex items-center text-white">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    <h1 class="text-xl font-bold">Form Generator Prompt Profesional</h1>
                </div>

                <div class="card rounded-b-xl p-6 lg:p-8">
                    <form id="promptForm" class="space-y-8"> 
                        <div class="p-4 border border-gray-200 rounded-lg bg-white">
                            <h2 class="form-category-title">1. Detail Subjek dan Aksi (Wajib)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div>
                                    <label for="subject" class="block text-sm font-medium text-gray-700 mb-1">1. Subjek</label>
                                    <input type="text" id="subject" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Contoh: naga, seorang koki">
                                </div>
                                <div>
                                    <label for="mainAction" class="block text-sm font-medium text-gray-700 mb-1">2. Aksi Utama</label>
                                    <input type="text" id="mainAction" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Contoh: terbang di langit, memasak rendang">
                                </div>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-200 rounded-lg bg-white">
                            <h2 class="form-category-title">2. Detail Tambahan (Opsional)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div>
                                    <label for="subjectCharacteristics" class="block text-sm font-medium text-gray-700 mb-1">3. Karakteristik Subjek</label>
                                    <select id="subjectCharacteristics" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <optgroup label="Pasar & Perdagangan">
                                            <option value="pedagang pasar tradisional yang ramah">Pedagang Pasar Tradisional yang Ramah</option>
                                            <option value="pedagang kaki lima yang gigih">Pedagang Kaki Lima yang Gigih</option>
                                            <option value="pedagang warung kopi yang ceria">Pedagang Warung Kopi yang Ceria</option>
                                            <option value="pedagang makanan tradisional yang bersemangat">Pedagang Makanan Tradisional yang Bersemangat</option>
                                            <option value="pedagang buah-buahan yang ramah">Pedagang Buah-buahan yang Ramah</option>
                                            <option value="pedagang ikan yang tangguh">Pedagang Ikan yang Tangguh</option>
                                            <option value="pedagang sayuran yang tekun">Pedagang Sayuran yang Tekun</option>
                                            <option value="pedagang bumbu dapur yang teliti">Pedagang Bumbu Dapur yang Teliti</option>
                                        </optgroup>
                                        <optgroup label="Pertanian & Perkebunan">
                                            <option value="petani padi yang tekun">Petani Padi yang Tekun</option>
                                            <option value="petani sayuran yang teliti">Petani Sayuran yang Teliti</option>
                                            <option value="petani buah-buahan yang sabar">Petani Buah-buahan yang Sabar</option>
                                            <option value="petani kopi yang berdedikasi">Petani Kopi yang Berdedikasi</option>
                                            <option value="petani teh yang telaten">Petani Teh yang Telaten</option>
                                            <option value="petani rempah yang cermat">Petani Rempah yang Cermat</option>
                                            <option value="petani organik yang inovatif">Petani Organik yang Inovatif</option>
                                            <option value="petani hidroponik yang modern">Petani Hidroponik yang Modern</option>
                                        </optgroup>
                                        <optgroup label="Pembawa Acara & Presenter">
                                            <option value="pembawa acara talkshow yang interaktif">Pembawa Acara Talkshow yang Interaktif</option>
                                            <option value="pembawa berita profesional yang tegas">Pembawa Berita Profesional yang Tegas</option>
                                        </optgroup>
                                    </select>
                                    <div id="customSubjectCharacteristicsInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan karakteristik subjek...">
                                    </div>
                                </div>
                                <div>
                                    <label for="emotion" class="block text-sm font-medium text-gray-700 mb-1">4. Emosi</label>
                                    <select id="emotion" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Tidak Ada Emosi Spesifik</option>
                                        <optgroup label="Emosi Positif">
                                            <option value="ramah tamah">Ramah Tamah</option>
                                            <option value="sopan santun">Sopan Santun</option>
                                            <option value="ikhlas">Ikhlas</option>
                                            <option value="sabar">Sabar</option>
                                            <option value="gigih">Gigih</option>
                                        </optgroup>
                                        <optgroup label="Semangat">
                                            <option value="bersemangat">Bersemangat</option>
                                            <option value="penuh semangat">Penuh Semangat</option>
                                            <option value="bergairah">Bergairah</option>
                                            <option value="antusias">Antusias</option>
                                            <option value="bersemangat tinggi">Bersemangat Tinggi</option>
                                        </optgroup>
                                        <optgroup label="Ketenangan">
                                            <option value="tenang">Tenang</option>
                                            <option value="tenteram">Tenteram</option>
                                            <option value="damai">Damai</option>
                                            <option value="nyaman">Nyaman</option>
                                            <option value="tentram">Tentram</option>
                                        </optgroup>
                                        <optgroup label="Kebahagiaan">
                                            <option value="gembira">Gembira</option>
                                            <option value="ceria">Ceria</option>
                                            <option value="bahagia">Bahagia</option>
                                            <option value="riang">Riang</option>
                                            <option value="sukacita">Sukacita</option>
                                        </optgroup>
                                    </select>
                                    <div id="customEmotionInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan emosi...">
                                    </div>
                                </div>
                                <div>
                                    <label for="location" class="block text-sm font-medium text-gray-700 mb-1">5. Tempat (Lokasi)</label>
                                    <select id="location" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Tidak Ada Lokasi Spesifik</option>
                                        <optgroup label="Pasar & Perdagangan">
                                            <option value="pasar tradisional yang ramai">Pasar Tradisional yang Ramai</option>
                                            <option value="pasar pagi yang sibuk">Pasar Pagi yang Sibuk</option>
                                            <option value="warung kopi yang nyaman">Warung Kopi yang Nyaman</option>
                                        </optgroup>
                                        <optgroup label="Alam">
                                            <option value="sawah yang hijau">Sawah yang Hijau</option>
                                            <option value="kebun yang subur">Kebun yang Subur</option>
                                            <option value="hutan hujan tropis">Hutan Hujan Tropis</option>
                                            <option value="pegunungan yang megah">Pegunungan yang Megah</option>
                                            <option value="pantai yang indah">Pantai yang Indah</option>
                                        </optgroup>
                                    </select>
                                    <div id="customLocationInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan lokasi...">
                                    </div>
                                </div>
                                <div>
                                    <label for="time" class="block text-sm font-medium text-gray-700 mb-1">6. Waktu</label>
                                    <select id="time" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Tidak Ada Waktu Spesifik</option>
                                        <optgroup label="Pagi">
                                            <option value="subuh yang sejuk">Subuh yang Sejuk</option>
                                            <option value="pagi yang cerah">Pagi yang Cerah</option>
                                            <option value="matahari terbit (golden hour)">Matahari Terbit (Golden Hour)</option>
                                        </optgroup>
                                        <optgroup label="Siang">
                                            <option value="siang yang terik">Siang yang Terik</option>
                                            <option value="tengah hari yang panas">Tengah Hari yang Panas</option>
                                        </optgroup>
                                        <optgroup label="Sore">
                                            <option value="sore yang hangat">Sore yang Hangat</option>
                                            <option value="senja (golden hour)">Senja (Golden Hour)</option>
                                        </optgroup>
                                        <optgroup label="Malam">
                                            <option value="malam yang sejuk">Malam yang Sejuk</option>
                                            <option value="tengah malam yang sunyi">Tengah Malam yang Sunyi</option>
                                        </optgroup>
                                    </select>
                                    <div id="customTimeInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan waktu...">
                                    </div>
                                </div>
                                <div>
                                    <label for="weather" class="block text-sm font-medium text-gray-700 mb-1">7. Cuaca</label>
                                    <select id="weather" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                         <option value="">Tidak Ada Cuaca Spesifik</option>
                                        <optgroup label="Cerah">
                                            <option value="cerah berkilau">Cerah Berkilau</option>
                                            <option value="matahari bersinar terang">Matahari Bersinar Terang</option>
                                        </optgroup>
                                        <optgroup label="Hujan">
                                            <option value="hujan rintik-rintik">Hujan Rintik-rintik</option>
                                            <option value="hujan deras">Hujan Deras</option>
                                        </optgroup>
                                         <optgroup label="Berawan">
                                            <option value="berawan lembut">Berawan Lembut</option>
                                            <option value="mendung">Mendung</option>
                                        </optgroup>
                                    </select>
                                    <div id="customWeatherInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan cuaca...">
                                    </div>
                                </div>
                                 <div class="md:col-span-2">
                                    <label for="additionalDetails" class="block text-sm font-medium text-gray-700 mb-1">Detail Tambahan Lainnya (Opsional)</label>
                                    <textarea id="additionalDetails" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" rows="2" placeholder="Misalnya: warna dominan, objek spesifik di latar belakang, dll."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-200 rounded-lg bg-white">
                            <h2 class="form-category-title">3. Detail Sinematografi (Opsional)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div>
                                    <label for="style" class="block text-sm font-medium text-gray-700 mb-1">Gaya Video</label>
                                    <select id="style" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Biarkan AI Memilih</option>
                                        <option value="sinematik yang epik">Sinematik yang Epik</option>
                                        <option value="dokumenter yang mendalam">Dokumenter yang Mendalam</option>
                                        <option value="anime yang dinamis">Anime yang Dinamis</option>
                                        <option value="kartun yang ceria">Kartun yang Ceria</option>
                                        <option value="realistis yang natural">Realistis yang Natural</option>
                                    </select>
                                    <div id="customStyleInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan gaya video...">
                                    </div>
                                </div>
                                <div>
                                    <label for="cameraMovement" class="block text-sm font-medium text-gray-700 mb-1">Gerakan Kamera</label>
                                    <select id="cameraMovement" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Biarkan AI Memilih</option>
                                        <option value="statik yang stabil">Statik yang Stabil</option>
                                        <option value="panning yang halus">Panning yang Halus</option>
                                        <option value="dolly yang dinamis">Dolly yang Dinamis</option>
                                        <option value="tracking yang mengalir">Tracking yang Mengalir</option>
                                        <option value="drone yang spektakuler">Drone yang Spektakuler</option>
                                    </select>
                                    <div id="customCameraMovementInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan gerakan kamera...">
                                    </div>
                                </div>
                                <div>
                                    <label for="cameraAngle" class="block text-sm font-medium text-gray-700 mb-1">Sudut Kamera</label>
                                    <select id="cameraAngle" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Biarkan AI Memilih</option>
                                        <option value="setinggi mata yang natural">Setinggi Mata (Eye Level)</option>
                                        <option value="sudut rendah yang dramatis">Sudut Rendah (Low Angle)</option>
                                        <option value="sudut tinggi yang mengesankan">Sudut Tinggi (High Angle)</option>
                                        <option value="sudut mata burung yang spektakuler">Sudut Mata Burung (Bird's Eye View)</option>
                                    </select>
                                    <div id="customCameraAngleInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan sudut kamera...">
                                    </div>
                                </div>
                                <div>
                                    <label for="focalLength" class="block text-sm font-medium text-gray-700 mb-1">Panjang Fokus Lensa</label>
                                    <select id="focalLength" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Biarkan AI Memilih</option>
                                        <option value="lebar (wide angle)">Lebar (Wide Angle, mis: 24mm)</option>
                                        <option value="medium (standard)">Medium (Standard, mis: 50mm)</option>
                                        <option value="telefoto (telephoto)">Telefoto (Telephoto, mis: 85mm)</option>
                                        <option value="makro (macro)">Makro (Macro)</option>
                                    </select>
                                    <div id="customFocalLengthInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan panjang fokus...">
                                    </div>
                                </div>
                                <div>
                                    <label for="lighting" class="block text-sm font-medium text-gray-700 mb-1">Pencahayaan</label>
                                    <select id="lighting" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Biarkan AI Memilih</option>
                                        <option value="alami (natural light)">Alami (Natural Light)</option>
                                        <option value="dramatis (dramatic lighting)">Dramatis</option>
                                        <option value="lembut (soft lighting)">Lembut (Soft Lighting)</option>
                                        <option value="golden hour">Golden Hour</option>
                                        <option value="blue hour">Blue Hour</option>
                                        <option value="low key">Low Key</option>
                                        <option value="high key">High Key</option>
                                    </select>
                                    <div id="customLightingInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan pencahayaan...">
                                    </div>
                                </div>
                                <div>
                                    <label for="colorGrading" class="block text-sm font-medium text-gray-700 mb-1">Gradiasi Warna</label>
                                    <select id="colorGrading" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="">Biarkan AI Memilih</option>
                                        <option value="alami dan natural">Alami dan Natural</option>
                                        <option value="hangat (warm tones)">Hangat (Warm Tones)</option>
                                        <option value="dingin (cool tones)">Dingin (Cool Tones)</option>
                                        <option value="vintage atau retro">Vintage atau Retro</option>
                                        <option value="monokrom (hitam putih)">Monokrom (Hitam Putih)</option>
                                        <option value="saturasi tinggi (vibrant)">Saturasi Tinggi (Vibrant)</option>
                                        <option value="desaturasi (muted)">Desaturasi (Muted)</option>
                                    </select>
                                    <div id="customColorGradingInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan gradiasi warna...">
                                    </div>
                                </div>
                                 <div>
                                    <label for="videoQuality" class="block text-sm font-medium text-gray-700 mb-1">Kualitas & Aspek Rasio</label>
                                    <select id="videoQuality" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="HD (16:9)">HD (16:9)</option>
                                        <option value="Full HD (16:9)">Full HD (16:9)</option>
                                        <option value="4K (16:9)">4K (16:9)</option>
                                        <option value="HD Portrait (9:16)">HD Portrait (9:16)</option>
                                        <option value="Full HD Portrait (9:16)">Full HD Portrait (9:16)</option>
                                        <option value="Square (1:1)">Square (1:1)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-200 rounded-lg bg-white">
                            <h2 class="form-category-title">4. Detail Audio (Opsional)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                 <div>
                                    <label for="dialog" class="block text-sm font-medium text-gray-700 mb-1">Dialog</label>
                                    <select id="dialog" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="none" selected>Tanpa Dialog</option>
                                        <option value="narasi yang informatif">Narasi yang Informatif</option>
                                        <option value="dialog yang natural">Dialog yang Natural</option>
                                    </select>
                                     <div id="customDialogInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan dialog...">
                                    </div>
                                </div>
                                <div>
                                    <label for="backgroundMusic" class="block text-sm font-medium text-gray-700 mb-1">Musik Latar</label>
                                    <select id="backgroundMusic" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="none" selected>Tanpa Musik</option>
                                        <optgroup label="Genre">
                                            <option value="instrumental yang elegan">Instrumental yang Elegan</option>
                                            <option value="pop yang energik">Pop yang Energik</option>
                                        </optgroup>
                                        <optgroup label="Suasana">
                                            <option value="dramatis yang intens">Dramatis yang Intens</option>
                                        </optgroup>
                                    </select>
                                     <div id="customMusicInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan musik...">
                                    </div>
                                </div>
                                 <div>
                                    <label for="soundEffects" class="block text-sm font-medium text-gray-700 mb-1">Efek Suara</label>
                                    <select id="soundEffects" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="custom">Input Manual</option>
                                        <option value="none" selected>Tanpa Efek</option>
                                        <optgroup label="Alam">
                                            <option value="suara hujan menyejukkan">Suara Hujan Menyejukkan</option>
                                            <option value="suara angin sepoi-sepoi">Suara Angin Sepoi-sepoi</option>
                                        </optgroup>
                                    </select>
                                     <div id="customSoundEffectsInput" class="hidden mt-2">
                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan efek suara...">
                                    </div>
                                </div>
                                <div>
                                    <label for="audioTranslation" class="block text-sm font-medium text-gray-700 mb-1">Terjemahan Audio (Jika ada dialog)</label>
                                    <select id="audioTranslation" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">
                                        <option value="none" selected>Tanpa Terjemahan</option>
                                        <option value="english_subtitle">Subtitle Inggris (Dialog Asli)</option>
                                        <option value="english_voiceover">Alih Suara ke Bahasa Inggris</option>
                                    </select>
                                </div>
                            </div>
                             <div class="mt-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <div class="flex items-center justify-between cursor-pointer" onclick="toggleAudioMixing()">
                                    <h3 class="text-md font-semibold text-gray-700">Pengaturan Volume Audio (Jika ada audio)</h3>
                                    <svg id="audioMixingChevron" class="w-5 h-5 text-gray-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                                <div id="audioMixingContent" class="hidden mt-4 space-y-3">
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label for="dialogVolume" class="block text-sm font-medium text-gray-700">Volume Dialog: <span id="dialogVolumeValue" class="font-normal text-purple-600">80%</span></label>
                                            <input type="range" id="dialogVolume" min="0" max="100" value="80" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-slider">
                                        </div>
                                        <div>
                                            <label for="musicVolume" class="block text-sm font-medium text-gray-700">Volume Musik: <span id="musicVolumeValue" class="font-normal text-purple-600">60%</span></label>
                                            <input type="range" id="musicVolume" min="0" max="100" value="60" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-slider">
                                        </div>
                                        <div>
                                            <label for="effectsVolume" class="block text-sm font-medium text-gray-700">Volume Efek: <span id="effectsVolumeValue" class="font-normal text-purple-600">40%</span></label>
                                            <input type="range" id="effectsVolume" min="0" max="100" value="40" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-slider">
                                        </div>
                                        <div>
                                            <label for="overallVolume" class="block text-sm font-medium text-gray-700">Volume Master: <span id="overallVolumeValue" class="font-normal text-purple-600">100%</span></label>
                                            <input type="range" id="overallVolume" min="0" max="100" value="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-slider">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                         <input type="hidden" id="equalizer" value="none">
                        <input type="hidden" id="compression" value="none">
                        <input type="hidden" id="reverb" value="none">
                        <input type="hidden" id="spatialAudio" value="none">
                        <input type="hidden" id="showAudioMixing" value="false"> 
                        <input type="hidden" id="showAudioProcessing" value="false">
                        <input type="hidden" id="dialogCharacter" value="none"> <input type="hidden" id="voiceMood" value="none"> <input type="hidden" id="volume" value="sedang yang seimbang"> <div class="pt-4 space-y-3">
                            <button type="submit" id="generatePromptButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path></svg>
                                Buat Prompt Profesional
                            </button>
                            <div class="flex space-x-3">
                                <button type="button" id="resetButton" class="w-1/2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2A8.001 8.001 0 0019.418 15m0 0H15"></path></svg>
                                    Reset Semua Input
                                </button>
                                <button type="button" id="clearPromptButton" class="w-1/2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                                     <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                    Hapus Prompt (Live)
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="w-full lg:w-[500px] space-y-6">
                <div class="card rounded-xl p-6">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-lg font-semibold text-gray-700">Prompt Profesional Indonesia</h2>
                        <button type="button" class="copy-btn-output text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1 px-2 py-1 rounded border border-blue-200 hover:bg-blue-50 transition-colors" data-target="generatedPrompt">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            Salin
                        </button>
                    </div>
                    <div id="generatedPrompt" class="bg-gray-50 p-4 rounded-md border border-gray-200 min-h-[200px] max-h-[calc(50vh-150px)] overflow-y-auto text-sm text-gray-700 whitespace-pre-line">
                        <p class="text-gray-500">Prompt Bahasa Indonesia akan muncul di sini...</p>
                    </div>
                </div>
                <div class="card rounded-xl p-6">
                     <div class="flex justify-between items-center mb-3">
                        <h2 class="text-lg font-semibold text-gray-700">Professional English Prompt</h2>
                        <button type="button" class="copy-btn-output text-green-600 hover:text-green-800 text-xs font-medium flex items-center gap-1 px-2 py-1 rounded border border-green-200 hover:bg-green-50 transition-colors" data-target="generatedPromptEnglish">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            Copy
                        </button>
                    </div>
                    <div id="generatedPromptEnglish" class="bg-gray-50 p-4 rounded-md border border-gray-200 min-h-[200px] max-h-[calc(50vh-150px)] overflow-y-auto text-sm text-gray-700 whitespace-pre-line">
                        <p class="text-gray-500">Professional English prompt will appear here...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="apiKeyModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Setup API Key untuk Free Unlimited</h2>
                <button id="closeApiKeyModal" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <div class="mb-4 p-3 bg-green-light border border-green-200 rounded-md">
                <h3 class="text-md font-semibold text-green-700 mb-1">✨ Free Unlimited dengan API Key Gemini</h3>
                <p class="text-sm text-green-600">Gunakan API Key Gemini Anda sendiri untuk mendapat unlimited prompts gratis selamanya! Tidak ada batasan harian, tidak ada biaya berlangganan.</p>
                <ul class="list-disc list-inside text-xs text-green-500 mt-2 space-y-1">
                    <li>100% gratis dari Google AI Studio</li>
                    <li>Unlimited prompts tanpa batas</li>
                    <li>Data aman, API key tersimpan lokal</li>
                    <li>Response cepat langsung dari Gemini</li>
                </ul>
            </div>

            <div class="mb-4">
                <label for="geminiApiKeyInput" class="block text-sm font-medium text-gray-700 mb-1">Masukkan API Key Gemini Anda</label>
                <input type="password" id="geminiApiKeyInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 input-field" placeholder="AIza...">
                <p class="text-xs text-gray-500 mt-1">Dapatkan gratis di <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">Google AI Studio <svg class="inline w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a></p>
            </div>

            <button id="saveApiKeyButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-150 flex items-center justify-center mb-6">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                Simpan & Aktifkan Free Unlimited
            </button>

            <div class="border-t border-gray-200 pt-4">
                <h3 class="text-md font-semibold text-gray-700 mb-2">Tutorial Lengkap Setup API Key:</h3>
                <a href="https://www.youtube.com/watch?v=YOUR_YOUTUBE_TUTORIAL_ID" target="_blank" class="block w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-150 flex items-center justify-center mb-3">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                    Tonton Tutorial YouTube
                </a>
                <p class="text-sm font-medium text-gray-600 mb-1">Langkah Detail Setup:</p>
                <ol class="list-decimal list-inside text-xs text-gray-500 space-y-1">
                    <li>Buka Google AI Studio: <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">Klik link ini</a></li>
                    <li>Login Google: Masuk dengan akun Google</li>
                    <li>Create API Key: Klik tombol "Create API Key"</li>
                    <li>Pilih Project: Pilih atau buat project baru</li>
                    <li>Copy Key: Copy kode "AIza..."</li>
                    <li>Paste di Sini: Masukkan di form di atas</li>
                    <li>Klik Simpan: Klik tombol hijau di atas</li>
                    <li>Selesai: Unlimited prompts aktif!</li>
                </ol>
            </div>
             <div id="apiKeySuccessMessage" class="hidden mt-4 p-3 bg-green-light border border-green-300 rounded-md text-sm text-green-700">
                <p>✅ <strong>Setup berhasil:</strong> API Key Gemini Anda telah disimpan dan diaktifkan!</p>
                <p class="text-xs">API key disimpan aman di browser Anda, tidak dikirim ke server manapun kecuali saat request ke Gemini.</p>
            </div>
            <div id="apiKeyErrorMessage" class="hidden mt-4 p-3 bg-red-100 border border-red-300 rounded-md text-sm text-red-700">
                <p>❌ <strong>Setup Gagal:</strong> API Key tidak valid atau terjadi kesalahan. Silakan periksa kembali.</p>
            </div>
        </div>
    </div>


    <script type="module">
        const GEMINI_API_ENDPOINT_BASE = 'https://generativelanguage.googleapis.com/v1beta/models/';
        const API_KEY_STORAGE_KEY = 'geminiApiKey';
        const GEMINI_MODEL_FOR_TRANSLATION = 'gemini-2.0-flash'; 
        const GEMINI_MODEL_FOR_REFINEMENT = 'gemini-2.0-flash'; 

        const apiKeyStatusIcon = document.getElementById('apiKeyStatusIcon');
        const apiKeyStatusText = document.getElementById('apiKeyStatusText');
        const apiKeyInfoText = document.getElementById('apiKeyInfoText');
        const generatePromptButton = document.getElementById('generatePromptButton');
        const setupApiKeyButtonText = document.getElementById('setupApiKeyButtonText');

        function getApiKey() {
            return localStorage.getItem(API_KEY_STORAGE_KEY);
        }

        function saveApiKey(key) {
            localStorage.setItem(API_KEY_STORAGE_KEY, key);
            updateApiKeyStatusUI(true);
        }
        
        function clearApiKey() { 
            localStorage.removeItem(API_KEY_STORAGE_KEY);
            updateApiKeyStatusUI(false);
        }

        function updateApiKeyStatusUI(isKeySet) {
            if (isKeySet) {
                apiKeyStatusIcon.classList.remove('text-red-500');
                apiKeyStatusIcon.classList.add('text-green-500');
                apiKeyStatusIcon.innerHTML = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`;
                apiKeyStatusText.textContent = 'API Key Aktif';
                apiKeyStatusText.classList.remove('text-red-700', 'bg-red-100', 'border-red-300');
                apiKeyStatusText.classList.add('text-green-700', 'bg-green-100', 'border-green-300');
                apiKeyInfoText.textContent = 'Anda siap menggunakan generator dengan API Key Gemini Anda.';
                if (generatePromptButton) generatePromptButton.disabled = false;
                if(setupApiKeyButtonText) setupApiKeyButtonText.textContent = "Ganti API Key";

            } else {
                apiKeyStatusIcon.classList.remove('text-green-500');
                apiKeyStatusIcon.classList.add('text-red-500');
                apiKeyStatusIcon.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                apiKeyStatusText.textContent = 'API Key Belum Diatur';
                apiKeyStatusText.classList.remove('text-green-700', 'bg-green-100', 'border-green-300');
                apiKeyStatusText.classList.add('text-red-700', 'bg-red-100', 'border-red-300');
                apiKeyInfoText.textContent = 'Untuk menggunakan generator, Anda wajib menghubungkan API Key Gemini Anda.';
                if (generatePromptButton) generatePromptButton.disabled = true;
                if(setupApiKeyButtonText) setupApiKeyButtonText.textContent = "Setup API Key";
            }
        }

        async function callGeminiAPI(apiKey, model, promptText) {
            const endpoint = `${GEMINI_API_ENDPOINT_BASE}${model}:generateContent?key=${apiKey}`;
            const requestBody = {
                "contents": [{"parts": [{"text": promptText}]}]
            };
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestBody),
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error(`Gemini API Error (${model}):`, errorData);
                    let errorMessage = `Error ${response.status}: ${response.statusText}.`;
                    if (errorData.error && errorData.error.message) {
                        errorMessage += ` Details: ${errorData.error.message}`;
                    }
                    if (response.status === 400 && errorData.error.message.toLowerCase().includes("api key not valid")) {
                        errorMessage = "API Key tidak valid. Silakan periksa kembali atau ganti API Key Anda.";
                        clearApiKey(); 
                    } else if (response.status === 429) {
                        errorMessage = "Terlalu banyak permintaan ke API (Quota Exceeded). Coba lagi nanti.";
                    } else if (response.status === 503) { // Specifically catch 503
                        errorMessage = "Model sedang overload. Silakan coba lagi setelah beberapa saat.";
                    }
                    return { success: false, data: null, error: errorMessage };
                }
                const data = await response.json();
                console.log(`Gemini API Response (${model}):`, data);
                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
                    return { success: true, data: data.candidates[0].content.parts[0].text, error: null };
                } else if (data.promptFeedback && data.promptFeedback.blockReason) {
                     return { success: false, data: null, error: `Blocked. Reason: ${data.promptFeedback.blockReason}. Details: ${data.promptFeedback.safetyRatings.map(r => `${r.category} - ${r.probability}`).join(', ')}`};
                }
                return { success: false, data: null, error: "No content in response or unexpected format."};
            } catch (error) {
                console.error(`Network or other error during API call (${model}):`, error);
                return { success: false, data: null, error: `Network error: ${error.message}. Check console.`};
            }
        }

        const promptHandler = {
            refinePrompt: async (subject, action, apiKey) => {
                if (!apiKey) return { success: false, data: null, error: "API Key is missing for prompt refinement." };
                
                const refinementInstruction = `Anda adalah asisten pembuatan prompt video yang ahli untuk platform Veo 3. Berdasarkan Subjek dan Aksi berikut, buatlah prompt video dalam Bahasa Indonesia yang sangat sinematik dan deskriptif. Sertakan detail seperti jenis shot (misalnya, establishing shot, close-up), pergerakan kamera, sudut kamera, pencahayaan (misalnya, golden hour, low key), dan gradasi warna untuk menciptakan visual yang menarik dan imersif. JANGAN sertakan bagian "Audio" atau "Kualitas Video" atau "Detail Tambahan" dalam output Anda, fokus hanya pada deskripsi visual sinematik.

Subjek: "${subject}"
Aksi: "${action}"

Contoh output yang diinginkan (hanya sebagai referensi gaya, jangan meniru persis):
'Sebuah naga perkasa terbang tinggi di angkasa. Shot establishing dari wide angle lens (24mm, f/8) menangkap seluruh cakrawala, dengan naga sebagai titik fokus dinamis di tengah frame. Pencahayaan golden hour memberikan backlight dramatis, menyoroti siluet naga dan tekstur sisiknya. Color grading hangat dengan sentuhan teal di langit untuk menciptakan kontras visual yang menarik.'

Prompt Video Sinematik (Bahasa Indonesia):`;
                return await callGeminiAPI(apiKey, GEMINI_MODEL_FOR_REFINEMENT, refinementInstruction);
            },
            translateText: async (text, apiKey) => {
                if (!apiKey) return { success: false, data: null, error: "API Key is missing for translation." };
                const translationInstruction = `Translate the following Indonesian text to proficient and natural-sounding English. Maintain the original structure, placeholders (e.g., (Volume: X%)), and any technical video terms if present: "${text}"`;
                return await callGeminiAPI(apiKey, GEMINI_MODEL_FOR_TRANSLATION, translationInstruction);
            }
        };
        
        function getElementValue(id, defaultValue = '') { return document.getElementById(id) ? document.getElementById(id).value : defaultValue; }
        function getCustomInputValue(selector, defaultValue = '') { const el = document.querySelector(selector); return el ? (el.value.trim() || defaultValue) : defaultValue; }
        function updateVolumeDisplay(inputId, displayId) { const i = document.getElementById(inputId), d = document.getElementById(displayId); if (i && d) d.textContent = i.value + '%'; }
        window.toggleAudioMixing = function() { const c = document.getElementById('audioMixingContent'), v = document.getElementById('audioMixingChevron'); c.classList.toggle('hidden'); v.classList.toggle('rotate-180'); document.getElementById('showAudioMixing').value = !c.classList.contains('hidden').toString(); };

        async function generatePromptLogic() {
            const currentApiKey = getApiKey();
            if (!currentApiKey) {
                alert("Harap setup API Key Gemini Anda terlebih dahulu untuk membuat prompt.");
                document.getElementById('apiKeyModal').classList.add('active');
                return;
            }

            const generatedPromptDiv = document.getElementById('generatedPrompt');
            const generatedPromptEnglishDiv = document.getElementById('generatedPromptEnglish');
            
            generatedPromptDiv.innerHTML = `<div class="flex items-center justify-center p-4"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500"></div><span class="ml-2 text-gray-500 text-sm">Membuat prompt sinematik...</span></div>`;
            generatedPromptEnglishDiv.innerHTML = `<p class="text-gray-500">Menunggu prompt Bahasa Indonesia...</p>`;


            try {
                const getVal = (id, customInputSelector, defaultValIfEmpty = '') => {
                    let val = getElementValue(id);
                    if (val === 'custom') {
                        val = getCustomInputValue(customInputSelector, ''); 
                    }
                    return val || defaultValIfEmpty; 
                };

                const subject = getElementValue('subject');
                const mainAction = getElementValue('mainAction'); 

                if (!subject.trim() || !mainAction.trim()) {
                    alert("Field 'Subjek' dan 'Aksi Utama' wajib diisi.");
                    generatedPromptDiv.innerHTML = '<p class="text-red-500">Field Subjek dan Aksi Utama wajib diisi.</p>';
                    return;
                }
                
                const refinementResult = await promptHandler.refinePrompt(subject, mainAction, currentApiKey);
                let basePromptIndonesia;

                if (refinementResult.success) {
                    basePromptIndonesia = refinementResult.data;
                } else {
                    generatedPromptDiv.innerHTML = `<p class="text-red-500">Gagal membuat prompt sinematik: ${refinementResult.error}</p>`;
                    generatedPromptEnglishDiv.innerHTML = `<p class="text-red-500">Menunggu prompt Bahasa Indonesia yang berhasil...</p>`;
                    return;
                }

                const subjectCharacteristics = getVal('subjectCharacteristics', '#customSubjectCharacteristicsInput input');
                const emotion = getVal('emotion', '#customEmotionInput input');
                const location = getVal('location', '#customLocationInput input');
                const time = getVal('time', '#customTimeInput input');
                const weather = getVal('weather', '#customWeatherInput input');
                const season = getVal('season', '#customSeasonInput input');
                
                const style = getVal('style', '#customStyleInput input');
                const cameraMovement = getVal('cameraMovement', '#customCameraMovementInput input');
                const cameraAngle = getVal('cameraAngle', '#customCameraAngleInput input');
                const focalLength = getVal('focalLength', '#customFocalLengthInput input');
                const lighting = getVal('lighting', '#customLightingInput input');
                const colorGrading = getVal('colorGrading', '#customColorGradingInput input');
                
                const dialogText = getVal('dialog', '#customDialogInput input');
                const dialogCharText = getVal('dialogCharacter', '#customDialogCharacterInput input');
                const voiceMoodText = getVal('voiceMood', '#customVoiceMoodInput input');
                const backgroundMusicText = getVal('backgroundMusic', '#customMusicInput input');
                const soundEffectsText = getVal('soundEffects', '#customSoundEffectsInput input');
                const volumeCharacteristic = getVal('volume', '#customVolumeInput input');

                const audioTranslation = getElementValue('audioTranslation'); 
                const videoQuality = getElementValue('videoQuality'); 
                const additionalDetails = getElementValue('additionalDetails');

                const showAudioMixing = document.getElementById('showAudioMixing').value === 'true';
                const dialogVolume = showAudioMixing ? getElementValue('dialogVolume', '80') : null;
                const musicVolume = showAudioMixing ? getElementValue('musicVolume', '60') : null;
                const effectsVolume = showAudioMixing ? getElementValue('effectsVolume', '40') : null; 
                const overallMasterVolume = showAudioMixing ? getElementValue('overallVolume', '100') : null;

                let finalPromptIndonesia = basePromptIndonesia;

                let optionalVisuals = [];
                if (subjectCharacteristics && subjectCharacteristics !== 'custom' && subjectCharacteristics.trim() !== '' && subjectCharacteristics.trim() !== 'Tidak Ada Karakteristik Spesifik') optionalVisuals.push(`Karakteristik subjek: ${subjectCharacteristics}`);
                if (emotion && emotion !== 'custom' && emotion.trim() !== '' && emotion.trim() !== 'Tidak Ada Emosi Spesifik') optionalVisuals.push(`Emosi yang ditonjolkan: ${emotion}`);
                if (location && location !== 'custom' && location.trim() !== '' && location.trim() !== 'Tidak Ada Lokasi Spesifik') optionalVisuals.push(`Berlokasi di ${location}`);
                if (time && time !== 'custom' && time.trim() !== '' && time.trim() !== 'Tidak Ada Waktu Spesifik') optionalVisuals.push(`Pada waktu ${time}`);
                if (weather && weather !== 'custom' && weather.trim() !== '' && weather.trim() !== 'Tidak Ada Cuaca Spesifik') optionalVisuals.push(`Dengan cuaca ${weather}`);
                if (season && season !== 'custom' && season.trim() !== '') optionalVisuals.push(`Pada ${season}`); // Assuming no "Tidak Ada Musim Spesifik" default
                
                if (style && style !== 'custom' && style.trim() !== '' && style.trim() !== 'Biarkan AI Memilih') optionalVisuals.push(`Gaya video tambahan: ${style}`);
                if (cameraMovement && cameraMovement !== 'custom' && cameraMovement.trim() !== '' && cameraMovement.trim() !== 'Biarkan AI Memilih') optionalVisuals.push(`Pergerakan kamera tambahan: ${cameraMovement}`);
                if (cameraAngle && cameraAngle !== 'custom' && cameraAngle.trim() !== '' && cameraAngle.trim() !== 'Biarkan AI Memilih') optionalVisuals.push(`Sudut kamera tambahan: ${cameraAngle}`);
                if (focalLength && focalLength !== 'custom' && focalLength.trim() !== '' && focalLength.trim() !== 'Biarkan AI Memilih') optionalVisuals.push(`Panjang fokus tambahan: ${focalLength}`);
                if (lighting && lighting !== 'custom' && lighting.trim() !== '' && lighting.trim() !== 'Biarkan AI Memilih') optionalVisuals.push(`Pencahayaan tambahan: ${lighting}`);
                if (colorGrading && colorGrading !== 'custom' && colorGrading.trim() !== '' && colorGrading.trim() !== 'Biarkan AI Memilih') optionalVisuals.push(`Gradiasi warna tambahan: ${colorGrading}`);


                if (optionalVisuals.length > 0) {
                    finalPromptIndonesia += `\n\nDetail Tambahan Visual: ${optionalVisuals.join('. ')}.`;
                }
                
                let audioDescriptionParts = [];
                 if (dialogText && dialogText !== 'none' && dialogText.trim() !== '') {
                    let currentDialogText = `Dialog: "${dialogText}"`;
                    // Note: dialogCharText and voiceMoodText are now standalone selects, not tied to dialogText directly in UI
                    // If they should only apply when dialogText is present, this logic is fine.
                    if (dialogCharText && dialogCharText !== 'none' && dialogCharText.trim() !== '') currentDialogText += ` oleh ${dialogCharText}`;
                    if (voiceMoodText && voiceMoodText !== 'none' && voiceMoodText.trim() !== '') currentDialogText += ` dengan suasana ${voiceMoodText}`;
                    if (dialogVolume) currentDialogText += ` (Volume: ${dialogVolume}%)`;
                    audioDescriptionParts.push(currentDialogText);
                }
                if (backgroundMusicText && backgroundMusicText !== 'none' && backgroundMusicText.trim() !== '') {
                    let currentMusicText = `Musik Latar: ${backgroundMusicText}`;
                    if (musicVolume) currentMusicText += ` (Volume: ${musicVolume}%)`;
                    audioDescriptionParts.push(currentMusicText);
                }
                if (soundEffectsText && soundEffectsText !== 'none' && soundEffectsText.trim() !== '') {
                    let currentEffectsText = `Efek Suara: ${soundEffectsText}`;
                    if (effectsVolume) currentEffectsText += ` (Volume: ${effectsVolume}%)`;
                    audioDescriptionParts.push(currentEffectsText);
                }
                if(volumeCharacteristic && volumeCharacteristic !== 'custom' && volumeCharacteristic.trim() !== '' && volumeCharacteristic.toLowerCase() !== 'sedang yang seimbang'){
                     audioDescriptionParts.push(`Karakteristik Volume Audio: ${volumeCharacteristic}`);
                }
                 if(audioTranslation && audioTranslation !== 'none'){
                     audioDescriptionParts.push(`Terjemahan Audio: ${audioTranslation}`);
                }


                if (audioDescriptionParts.length > 0) {
                    finalPromptIndonesia += `\n\nAudio: ${audioDescriptionParts.join(', ')}.`;
                    if (overallMasterVolume) finalPromptIndonesia += ` Volume Master Audio: ${overallMasterVolume}%.`;
                }
                
                finalPromptIndonesia += `\n\nKualitas Video: ${videoQuality || 'HD (16:9)'}.`;

                if (additionalDetails && additionalDetails.trim() !== '') {
                    finalPromptIndonesia += `\n\nCatatan Tambahan Penting: ${additionalDetails}`;
                }

                generatedPromptDiv.innerHTML = `<p class="text-gray-800 whitespace-pre-line">${finalPromptIndonesia}</p>`;
                
                generatedPromptEnglishDiv.innerHTML = `
                    <div class="flex items-center justify-center p-4">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500"></div>
                        <span class="ml-2 text-gray-500 text-sm">Menerjemahkan dengan Gemini API...</span>
                    </div>`;

                const translationResult = await promptHandler.translateText(finalPromptIndonesia, currentApiKey);
                if (translationResult.success) {
                    generatedPromptEnglishDiv.innerHTML = `<p class="text-gray-800 whitespace-pre-line">${translationResult.data}</p>`;
                } else {
                    generatedPromptEnglishDiv.innerHTML = `<p class="text-red-500">Gagal menerjemahkan: ${translationResult.error}</p>`;
                }

            } catch (error) {
                console.error('Error dalam generatePromptLogic:', error);
                generatedPromptDiv.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
                generatedPromptEnglishDiv.innerHTML = `<p class="text-red-500">Gagal memproses.</p>`;
            }
        }
        
        function setupCopyButtons() { /* ... unchanged ... */ document.querySelectorAll('.copy-btn-output').forEach(button => { button.addEventListener('click', async function() { const targetId = this.getAttribute('data-target'); const textElement = document.getElementById(targetId); if (!textElement) return; const textToCopy = textElement.innerText || textElement.textContent; const originalButtonHTML = this.innerHTML; try { await navigator.clipboard.writeText(textToCopy); this.innerHTML = `<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg><span class="ml-1">${this.textContent.trim().includes('Salin') ? 'Tersalin!' : 'Copied!'}</span>`; this.classList.add('text-green-600', 'border-green-400', 'bg-green-50'); this.classList.remove('text-blue-600', 'border-blue-200', 'hover:bg-blue-50', 'text-red-500', 'border-red-400'); } catch (err) { console.warn('navigator.clipboard.writeText failed, trying execCommand:', err); const textArea = document.createElement("textarea"); textArea.value = textToCopy; textArea.style.position = "fixed"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); this.innerHTML = `<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg><span class="ml-1">${this.textContent.trim().includes('Salin') ? 'Tersalin!' : 'Copied!'}</span>`; this.classList.add('text-green-600', 'border-green-400', 'bg-green-50'); this.classList.remove('text-blue-600', 'border-blue-200', 'hover:bg-blue-50', 'text-red-500', 'border-red-400'); } catch (execErr) { console.error('Failed to copy with execCommand: ', execErr); this.innerHTML = 'Gagal Salin'; this.classList.add('text-red-500', 'border-red-400'); this.classList.remove('text-green-600', 'border-green-400', 'bg-green-50', 'text-blue-600', 'border-blue-200', 'hover:bg-blue-50'); } document.body.removeChild(textArea); } finally { setTimeout(() => { this.innerHTML = originalButtonHTML; this.classList.remove('text-green-600', 'border-green-400', 'bg-green-50', 'text-red-500', 'border-red-400'); if (this.textContent.trim().includes('Salin')) { this.classList.add('text-blue-600', 'border-blue-200', 'hover:bg-blue-50'); } else if (this.textContent.trim().includes('Copy')) { this.classList.add('text-green-600', 'border-green-200', 'hover:bg-green-50'); } }, 2000); } }); }); }
        const fieldsWithCustomInput = [ 
            'subjectCharacteristics', 'emotion', 'location', 'time', 'weather', 'season', 
            'style', 'cameraMovement', 'cameraAngle', 'focalLength', 'lighting', 'colorGrading',
            'dialog', 'backgroundMusic', 'soundEffects'
             // mainAction is now a text input, not a select with custom option
             // dialogCharacter, voiceMood, volume are also now standalone selects in the Audio section
        ];

        function addInputListeners() {
            fieldsWithCustomInput.forEach(id => { 
                const select = document.getElementById(id); 
                const customInputDivId = `custom${id.charAt(0).toUpperCase() + id.slice(1)}Input`; 
                const customInputDiv = document.getElementById(customInputDivId); 
                if (select && customInputDiv) { 
                    select.addEventListener('change', function() { 
                        customInputDiv.classList.toggle('hidden', this.value !== 'custom'); 
                        if(this.value !== 'custom') { 
                            const inputField = customInputDiv.querySelector('input'); 
                            if(inputField) inputField.value = ''; 
                        } 
                    }); 
                } 
            });
            
            const promptForm = document.getElementById('promptForm');
            if (promptForm) {
                promptForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    generatePromptLogic();
                });
            }
        }
        
        document.getElementById('resetButton')?.addEventListener('click', () => { 
            document.getElementById('promptForm').reset(); 
            fieldsWithCustomInput.forEach(id => { 
                const customInputDivId = `custom${id.charAt(0).toUpperCase() + id.slice(1)}Input`; 
                document.getElementById(customInputDivId)?.classList.add('hidden'); 
                const selectField = document.getElementById(id); 
                if (selectField && selectField.options.length > 0) { 
                    // Find the first non-custom, non-empty-value option to set as default
                    let defaultIndex = 0;
                    for(let i=0; i < selectField.options.length; i++) {
                        if(selectField.options[i].value !== 'custom' && selectField.options[i].value !== '') {
                            defaultIndex = i;
                            break;
                        }
                    }
                    selectField.selectedIndex = defaultIndex;
                }
            }); 
            updateVolumeDisplay('dialogVolume', 'dialogVolumeValue'); 
            updateVolumeDisplay('musicVolume', 'musicVolumeValue'); 
            updateVolumeDisplay('effectsVolume', 'effectsVolumeValue'); 
            updateVolumeDisplay('overallVolume', 'overallVolumeValue'); 
            const audioMixingContent = document.getElementById('audioMixingContent'); 
            if (audioMixingContent && !audioMixingContent.classList.contains('hidden')) { 
                document.getElementById('audioMixingChevron').classList.remove('rotate-180'); 
                audioMixingContent.classList.add('hidden'); 
                document.getElementById('showAudioMixing').value = 'false'; 
            } 
            const genPromptDiv = document.getElementById('generatedPrompt'); 
            const genPromptEngDiv = document.getElementById('generatedPromptEnglish'); 
            if(genPromptDiv) genPromptDiv.innerHTML = '<p class="text-gray-500">Prompt Bahasa Indonesia akan muncul di sini...</p>'; 
            if(genPromptEngDiv) genPromptEngDiv.innerHTML = '<p class="text-gray-500">Professional English prompt will appear here...</p>'; 
        });
        document.getElementById('clearPromptButton')?.addEventListener('click', () => { /* ... unchanged ... */ const genPromptDiv = document.getElementById('generatedPrompt'); const genPromptEngDiv = document.getElementById('generatedPromptEnglish'); if(genPromptDiv) genPromptDiv.innerHTML = '<p class="text-gray-500">Prompt Bahasa Indonesia akan muncul di sini...</p>'; if(genPromptEngDiv) genPromptEngDiv.innerHTML = '<p class="text-gray-500">Professional English prompt will appear here...</p>'; });

        const setupApiKeyButton = document.getElementById('setupApiKeyButton');
        const apiKeyModal = document.getElementById('apiKeyModal');
        const closeApiKeyModalButton = document.getElementById('closeApiKeyModal');
        const saveApiKeyButton = document.getElementById('saveApiKeyButton');
        const geminiApiKeyInput = document.getElementById('geminiApiKeyInput'); 
        const apiKeySuccessMessage = document.getElementById('apiKeySuccessMessage');
        const apiKeyErrorMessage = document.getElementById('apiKeyErrorMessage');


        if (setupApiKeyButton && apiKeyModal && closeApiKeyModalButton && saveApiKeyButton) {
            setupApiKeyButton.addEventListener('click', () => {
                geminiApiKeyInput.value = getApiKey() || ''; 
                apiKeyModal.classList.add('active');
            });
            closeApiKeyModalButton.addEventListener('click', () => {
                apiKeyModal.classList.remove('active');
                apiKeySuccessMessage.classList.add('hidden');
                apiKeyErrorMessage.classList.add('hidden');
            });
            apiKeyModal.addEventListener('click', (event) => { 
                if (event.target === apiKeyModal) {
                    apiKeyModal.classList.remove('active');
                    apiKeySuccessMessage.classList.add('hidden');
                    apiKeyErrorMessage.classList.add('hidden');
                }
            });
            saveApiKeyButton.addEventListener('click', async () => {
                const apiKey = geminiApiKeyInput.value.trim();
                if (apiKey) {
                    saveApiKey(apiKey); 
                    apiKeySuccessMessage.classList.remove('hidden');
                    apiKeyErrorMessage.classList.add('hidden');
                    setTimeout(() => {
                        apiKeyModal.classList.remove('active');
                    }, 1500);
                } else {
                    apiKeyErrorMessage.textContent = "API Key tidak boleh kosong.";
                    apiKeyErrorMessage.classList.remove('hidden');
                    apiKeySuccessMessage.classList.add('hidden');
                }
            });
        }


        document.addEventListener('DOMContentLoaded', async function() {
            addInputListeners();
            setupCopyButtons();
            
            updateVolumeDisplay('dialogVolume', 'dialogVolumeValue');
            updateVolumeDisplay('musicVolume', 'musicVolumeValue');
            updateVolumeDisplay('effectsVolume', 'effectsVolumeValue');
            updateVolumeDisplay('overallVolume', 'overallVolumeValue');
            
            fieldsWithCustomInput.forEach(id => { const select = document.getElementById(id); const customInputDivId = `custom${id.charAt(0).toUpperCase() + id.slice(1)}Input`; const customInputDiv = document.getElementById(customInputDivId); if (select && customInputDiv) { customInputDiv.classList.toggle('hidden', select.value !== 'custom'); } });

            updateApiKeyStatusUI(!!getApiKey()); 

            const genPromptDiv = document.getElementById('generatedPrompt'); 
            const genPromptEngDiv = document.getElementById('generatedPromptEnglish'); 
            if(genPromptDiv) genPromptDiv.innerHTML = '<p class="text-gray-500">Silakan atur API Key Gemini Anda dan klik "Buat Prompt Profesional".</p>'; 
            if(genPromptEngDiv) genPromptEngDiv.innerHTML = '<p class="text-gray-500">Please set up your Gemini API Key and click "Buat Prompt Profesional".</p>';
        });

    </script>
</body>
</html>
