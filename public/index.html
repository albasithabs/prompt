<!DOCTYPE html>

<html lang="id" class=""> <!-- Class 'dark' akan ditambahkan di sini oleh JS -->

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Generator Prompt Profesional</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>

        tailwind.config = {

            darkMode: 'class', // Enable dark mode using a class

            theme: {

                extend: {

                    colors: {

                        primary: '#3B82F6', // Blue

                        secondary: '#1E40AF',

                        accent: '#60A5FA',

                        dark: '#1F2937', // Darker gray for text or components in light mode

                        light: '#F9FAFB', // Lighter gray for backgrounds in light mode

                        purple: {

                            DEFAULT: '#8B5CF6',

                            dark: '#7C3AED',

                            light: '#A78BFA',

                        },

                        orange: {

                            DEFAULT: '#F97316',

                            dark: '#EA580C',

                        },

                        green: {

                            DEFAULT: '#22C55E',

                            dark: '#16A34A',

                            light: '#DCFCE7'

                        },

                        teal: {

                            DEFAULT: '#14B8A6',

                            dark: '#0D9488'

                        },

                        // Dark mode specific colors

                        'dark-bg': '#111827', // Main background for dark mode

                        'dark-card': '#1F2937', // Card background for dark mode

                        'dark-border': '#374151', // Border color for dark mode

                        'dark-text': '#D1D5DB', // Main text color for dark mode

                        'dark-text-secondary': '#9CA3AF', // Secondary text color

                        'dark-input-bg': '#374151',

                        'dark-input-border': '#4B5563',

                    },

                    fontFamily: {

                        sans: ['Inter', 'sans-serif']

                    }

                }

            }

        }

    </script>

    <style>

        /* Light Mode Base (can be overridden by Tailwind) */

        body {

            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);

            min-height: 100vh;

            font-family: 'Inter', sans-serif;

            color: #1F2937; /* Default text color for light mode */

        }

        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); border: 1px solid rgba(209, 213, 219, 0.3); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); }

        .input-field, .select-field { transition: all 0.3s ease; border-color: #D1D5DB; background-color: white; }

        .input-field:focus, .select-field:focus { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1); border-color: #3B82F6; ring-width: 1px; ring-color: #3B82F6; }

        .form-category-title { font-size: 1.125rem; font-weight: 600; color: #374151; padding-bottom: 0.5rem; border-bottom: 1px solid #E5E7EB; margin-bottom: 1rem; }

        

        /* Dark Mode Styles */

        .dark body {

            background: #0f172a; /* Dark blueish gray background */

            color: #D1D5DB; /* Light gray text for dark mode */

        }

        .dark .card { 

            background: rgba(31, 41, 55, 0.95); /* dark-card with opacity */

            border-color: #4B5563; /* dark-border */

            box-shadow: 0 8px 32px rgba(0,0,0,0.2);

        }

        .dark .input-field, .dark .select-field {

            background-color: #374151; /* dark-input-bg */

            border-color: #4B5563; /* dark-input-border */

            color: #D1D5DB; /* dark-text */

        }

        .dark .input-field::placeholder { color: #9CA3AF; /* dark-text-secondary */ }

        .dark .input-field:focus, .dark .select-field:focus {

            border-color: #60A5FA; /* accent */

            ring-color: #60A5FA;

            box-shadow: 0 2px 8px rgba(96, 165, 250, 0.2);

        }

        .dark .form-category-title { 

            color: #9CA3AF; /* dark-text-secondary */

            border-bottom-color: #374151; /* dark-border */

        }

        .dark label, .dark h1, .dark h2, .dark h3, .dark p, .dark span:not(.bg-red-100):not(.bg-green-100) { /* Target general text elements */

             color: #D1D5DB; /* dark-text */

        }

        .dark #apiKeyInfoText, .dark .text-gray-500, .dark .text-gray-600, .dark .text-gray-700 {

            color: #9CA3AF !important; /* dark-text-secondary, important to override specific Tailwind grays */

        }

         .dark #apiKeyStatusText.text-red-700 { /* Specific for API error status in dark mode */

            background-color: #450a0a !important; /* Darker red */

            color: #fecaca !important; /* Lighter red text */

            border-color: #7f1d1d !important;

        }

        .dark #apiKeyStatusText.text-green-700 { /* Specific for API success status in dark mode */

            background-color: #064e3b !important; /* Darker green */

            color: #a7f3d0 !important; /* Lighter green text */

            border-color: #065f46 !important;

        }

        .dark .bg-gray-50 { background-color: #374151 !important; /* dark-input-bg */ }

        .dark .border-gray-200 { border-color: #4B5563 !important; /* dark-input-border */ }

        .dark .text-gray-800 { color: #D1D5DB !important; /* dark-text */ }

        .dark .bg-white { background-color: #1F2937 !important; /* dark-card */ }

        .dark .bg-gradient-to-r.from-purple-600.to-pink-500 {

            background-image: linear-gradient(to right, #581c87, #831843); /* Darker gradient */

        }

        .dark .text-blue-600 { color: #60A5FA !important; }

        .dark .hover\:text-blue-800:hover { color: #93c5fd !important; }

        .dark .border-blue-200 { border-color: #3b82f6 !important; }

        .dark .hover\:bg-blue-50:hover { background-color: rgba(59, 130, 246, 0.2) !important; }

        .dark .text-green-600 { color: #34d399 !important; }

        .dark .hover\:text-green-800:hover { color: #6ee7b7 !important; }

        .dark .border-green-200 { border-color: #10b981 !important; }

        .dark .hover\:bg-green-50:hover { background-color: rgba(16, 185, 129, 0.2) !important; }

        .dark .bg-gray-200 { background-color: #4B5563 !important; } /* Button reset/clear */

        .dark .hover\:bg-gray-300:hover { background-color: #6B7280 !important; }

        .dark .text-gray-700 { color: #D1D5DB !important; } /* Text on gray buttons */





        #generatedPrompt::-webkit-scrollbar, #generatedPromptEnglish::-webkit-scrollbar, #promptHistoryContainer::-webkit-scrollbar { width: 6px; }

        #generatedPrompt::-webkit-scrollbar-track, #generatedPromptEnglish::-webkit-scrollbar-track, #promptHistoryContainer::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }

        #generatedPrompt::-webkit-scrollbar-thumb, #generatedPromptEnglish::-webkit-scrollbar-thumb, #promptHistoryContainer::-webkit-scrollbar-thumb { background: #a8a29e; border-radius: 3px; }

        #generatedPrompt::-webkit-scrollbar-thumb:hover, #generatedPromptEnglish::-webkit-scrollbar-thumb:hover, #promptHistoryContainer::-webkit-scrollbar-thumb:hover { background: #78716c; }

        .dark #generatedPrompt::-webkit-scrollbar-track, .dark #generatedPromptEnglish::-webkit-scrollbar-track, .dark #promptHistoryContainer::-webkit-scrollbar-track { background: #374151; }

        .dark #generatedPrompt::-webkit-scrollbar-thumb, .dark #generatedPromptEnglish::-webkit-scrollbar-thumb, .dark #promptHistoryContainer::-webkit-scrollbar-thumb { background: #6B7280; }

        .dark #generatedPrompt::-webkit-scrollbar-thumb:hover, .dark #generatedPromptEnglish::-webkit-scrollbar-thumb:hover, .dark #promptHistoryContainer::-webkit-scrollbar-thumb:hover { background: #9CA3AF; }





        .range-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #8B5CF6; cursor: pointer; border-radius: 50%; }

        .range-slider::-moz-range-thumb { width: 16px; height: 16px; background: #8B5CF6; cursor: pointer; border-radius: 50%; border: none; }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-content { background-color: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }

        .dark .modal-content { background-color: #1F2937; border: 1px solid #374151;}

        .modal-overlay.active .modal-content { transform: scale(1); }

        button:disabled { background-color: #9CA3AF !important; border-color: #9CA3AF !important; color: #E5E7EB !important; cursor: not-allowed !important; }

        button:disabled:hover { background-color: #9CA3AF !important; }

        .speaker-entry { border-left: 3px solid #A78BFA; }

        .dark .speaker-entry { border-left-color: #7C3AED; background-color: #374151; }

        /* Toast Notification Style */

        .toast-notification {

            position: fixed;

            bottom: 20px;

            left: 50%;

            transform: translateX(-50%);

            background-color: #333;

            color: white;

            padding: 10px 20px;

            border-radius: 5px;

            z-index: 1000;

            opacity: 0;

            transition: opacity 0.5s ease-in-out;

            font-size: 0.875rem;

            text-align: center;

        }

        .toast-notification.show {

            opacity: 1;

        }

         .dark .toast-notification {

            background-color: #4B5563; /* Darker toast for dark mode */

            color: #F3F4F6;

        }

        #inputSuggestions {

            min-height: 40px; /* Ensure it has some height even when empty */

        }

    </style>

</head>

<body class="font-sans"> <!-- Default text color removed, will be set by light/dark mode -->

    <div class="container mx-auto px-4 py-8">



        <!-- Header Section with Dark Mode Toggle -->

        <div class="flex justify-between items-center mb-6">

            <h1 class="text-2xl font-bold text-primary dark:text-purple-400">Generator Prompt Profesional</h1>

            <button id="darkModeToggle" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">

                <!-- Sun Icon for Light Mode -->

                <svg id="sunIcon" class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-8.66l-.707.707M4.041 4.041l.707.707M21 12h-1M4 12H3m16.66 4.041l-.707-.707M5.45 17.96l.707-.707M12 5a7 7 0 100 14 7 7 0 000-14z"></path></svg>

                <!-- Moon Icon for Dark Mode (hidden by default) -->

                <svg id="moonIcon" class="w-6 h-6 text-purple-400 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>

            </button>

        </div>





        <!-- API Key Status Section -->

        <div class="max-w-4xl mx-auto mb-6 p-4 border border-gray-200 dark:border-dark-border rounded-lg shadow-sm bg-white dark:bg-dark-card">

            <div class="flex items-center justify-between mb-3">

                <div class="flex items-center">

                    <svg id="apiKeyStatusIcon" class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>

                    <h2 class="text-md font-semibold text-gray-700 dark:text-dark-text-secondary">Status API Key Gemini</h2>

                </div>

                <span id="apiKeyStatusText" class="text-xs text-red-700 bg-red-100 px-2 py-1 rounded-full font-medium border border-red-300">Belum Diatur</span>

            </div>

            <p id="apiKeyInfoText" class="text-sm text-gray-600 dark:text-dark-text-secondary mb-3">

                Generator memerlukan API Key Gemini untuk berfungsi. Silakan atur API Key Anda.

            </p>

            <div class="mt-4 flex flex-wrap items-center gap-3">

                <button id="setupApiKeyButton" class="flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md border border-green-600 text-green-700 hover:bg-green-50 dark:border-green-500 dark:text-green-400 dark:hover:bg-green-700 dark:hover:text-white transition-colors duration-150">

                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H5v-2H3v-2H1v-4a6 6 0 016-6h7zm0 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v2m0 0h2m0 0h2m0 0h2m0 0h2"></path></svg>

                    <span id="setupApiKeyButtonText">Setup API Key Pribadi</span>

                </button>

                <div id="sharedApiKeySection" class="mt-3 sm:mt-0">

                    <p class="text-xs text-gray-500 dark:text-dark-text-secondary mb-1">Tidak punya API Key? Salin API Key gratis kami (penggunaan bersama):</p>

                    <div class="flex items-center">

                        <input type="text" id="sharedApiKeyDisplay" value="AIzaSyBXLRt1DizlFrqJ68lIQNFrc-cirx1MHTQ" readonly class="w-auto text-xs p-2 border border-gray-300 dark:border-dark-input-border rounded-l-md bg-gray-50 dark:bg-dark-input-bg focus:outline-none">

                        <button id="copySharedApiKeyButton" class="px-3 py-2 text-xs font-medium text-white bg-purple-600 hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800 rounded-r-md transition-colors duration-150 flex items-center">

                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8zM6 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h4a1 1 0 100-2H7z"></path><path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3 1h10a1 1 0 011 1v8a1 1 0 01-1 1H5a1 1 0 01-1-1V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>

                            Salin API Key Gratis

                        </button>

                    </div>

                </div>

            </div>

        </div>

        

        <div class="max-w-7xl mx-auto flex flex-col lg:flex-row gap-6">

            <!-- Form Section -->

            <div class="flex-1">

                <div class="bg-gradient-to-r from-purple-600 to-pink-500 dark:from-purple-800 dark:to-pink-700 p-4 rounded-t-xl flex items-center text-white">

                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>

                    <h1 class="text-xl font-bold">Form Generator Prompt Profesional</h1>

                </div>



                <div class="card rounded-b-xl p-6 lg:p-8">

                    <form id="promptForm" class="space-y-8"> 

                        <!-- Section 1: Detail Utama Prompt -->

                        <div class="p-4 border border-gray-200 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card">

                            <h2 class="form-category-title">1. Detail Utama Prompt</h2>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

                                <div>

                                    <label for="subject" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">1. Subjek Utama</label>

                                    <input type="text" id="subject" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Contoh: naga, seorang koki, mobil sport">

                                </div>

                                <div>

                                    <label for="mainAction" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">2. Aksi Utama Subjek</label>

                                    <input type="text" id="mainAction" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Contoh: terbang di langit, memasak rendang, melaju kencang">

                                </div>

                                <div>

                                    <label for="promptPurpose" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">3. Kebutuhan Prompt Untuk</label>

                                    <select id="promptPurpose" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="video_sinematik" selected>Video Sinematik (Veo 3)</option>

                                        <option value="gambar_realistis">Gambar Realistis (Text-to-Image)</option>

                                        <option value="gambar_seni_digital">Gambar Seni Digital (Text-to-Image)</option>

                                        <option value="iklan_produk">Iklan Produk (Video/Gambar)</option>

                                        <option value="konten_medsos">Konten Media Sosial (Video/Gambar)</option>

                                        <option value="presentasi_edukasi">Presentasi / Edukasi (Visual)</option>

                                        <option value="podcast_visual">Visual Pendukung Podcast (Audio)</option>

                                        <option value="konsep_game">Konsep Seni Game</option>

                                        <option value="lainnya">Lainnya (Jelaskan di Detail Tambahan)</option>

                                    </select>

                                    <div id="customPromptPurposeInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan kebutuhan prompt...">

                                    </div>

                                </div>

                                <div>

                                    <label for="outputMediaType" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">4. Target Output Media</label>

                                    <select id="outputMediaType" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="video" selected>Video (Untuk Veo 3 / Model Teks-ke-Video)</option>

                                        <option value="gambar">Gambar (Untuk Model Teks-ke-Gambar)</option>

                                    </select>

                                </div>

                            </div>

                        </div>



                        <!-- Section 2: Detail Visual & Suasana -->

                        <div class="p-4 border border-gray-200 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card">

                            <h2 class="form-category-title">2. Detail Visual & Suasana (Opsional)</h2>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

                                <div>

                                    <label for="subjectCharacteristics" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Karakteristik Subjek</label>

                                    <select id="subjectCharacteristics" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Tidak Ada Karakteristik Spesifik</option>

                                        <optgroup label="Manusia">

                                            <option value="seorang wanita Asia, usia 30-an, rambut dikuncir longgar">Wanita Asia, 30an, rambut dikuncir</option>

                                            <option value="pria Kaukasia, berjanggut, memakai kacamata">Pria Kaukasia, berjanggut, kacamata</option>

                                            <option value="anak kecil dengan senyum ceria">Anak kecil ceria</option>

                                        </optgroup>

                                        <optgroup label="Hewan">

                                            <option value="kucing oranye berbulu lebat">Kucing oranye lebat</option>

                                            <option value="anjing golden retriever yang bersemangat">Anjing golden retriever semangat</option>

                                            <option value="burung elang terbang gagah">Burung elang gagah</option>

                                        </optgroup>

                                        <optgroup label="Makhluk Fantasi">

                                            <option value="naga perkasa dengan sisik berkilau">Naga perkasa bersisik</option>

                                            <option value="peri hutan dengan sayap transparan">Peri hutan bersayap</option>

                                        </optgroup>

                                        <optgroup label="Profesi (Contoh)">

                                            <option value="pedagang pasar tradisional yang ramah">Pedagang Pasar Tradisional yang Ramah</option>

                                            <option value="petani padi yang tekun">Petani Padi yang Tekun</option>

                                            <option value="pembawa acara talkshow yang interaktif">Pembawa Acara Talkshow yang Interaktif</option>

                                        </optgroup>

                                    </select>

                                    <div id="customSubjectCharacteristicsInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan karakteristik subjek...">

                                    </div>

                                </div>

                                <div>

                                    <label for="emotion" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Emosi / Ekspresi</label>

                                    <select id="emotion" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Tidak Ada Emosi Spesifik</option>

                                        <optgroup label="Emosi Positif">

                                            <option value="ramah tamah">Ramah Tamah</option>

                                            <option value="ceria">Ceria</option>

                                            <option value="bahagia">Bahagia</option>

                                            <option value="bersemangat">Bersemangat</option>

                                            <option value="antusias">Antusias</option>

                                            <option value="penuh harap">Penuh Harap</option>

                                        </optgroup>

                                        <optgroup label="Emosi Negatif">

                                            <option value="sedih">Sedih</option>

                                            <option value="marah">Marah</option>

                                            <option value="takut">Takut</option>

                                            <option value="cemas">Cemas</option>

                                        </optgroup>

                                        <optgroup label="Emosi Netral/Kompleks">

                                            <option value="tenang">Tenang</option>

                                            <option value="fokus">Fokus</option>

                                            <option value="penasaran">Penasaran</option>

                                            <option value="misterius">Misterius</option>

                                            <option value="bijaksana">Bijaksana</option>

                                        </optgroup>

                                    </select>

                                    <div id="customEmotionInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan emosi...">

                                    </div>

                                </div>

                                <div>

                                    <label for="location" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Tempat (Lokasi)</label>

                                    <select id="location" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Tidak Ada Lokasi Spesifik</option>

                                        <optgroup label="Dalam Ruangan">

                                            <option value="dapur bernuansa kayu modern">Dapur bernuansa kayu modern</option>

                                            <option value="perpustakaan tua yang megah">Perpustakaan tua yang megah</option>

                                            <option value="studio seni yang terang">Studio seni yang terang</option>

                                            <option value="kafe yang nyaman dengan interior vintage">Kafe nyaman interior vintage</option>

                                        </optgroup>

                                        <optgroup label="Luar Ruangan - Alam">

                                            <option value="hutan hujan tropis yang lebat">Hutan hujan tropis yang lebat</option>

                                            <option value="pegunungan bersalju saat matahari terbit">Pegunungan bersalju saat matahari terbit</option>

                                            <option value="pantai berpasir putih dengan air jernih">Pantai berpasir putih, air jernih</option>

                                            <option value="padang rumput luas di bawah langit biru">Padang rumput luas, langit biru</option>

                                            <option value="sungai yang mengalir deras di antara bebatuan">Sungai deras di antara bebatuan</option>

                                        </optgroup>

                                        <optgroup label="Luar Ruangan - Perkotaan">

                                            <option value="jalan perkotaan yang ramai di malam hari">Jalan perkotaan ramai di malam hari</option>

                                            <option value="taman kota dengan bunga berwarna-warni">Taman kota dengan bunga</option>

                                            <option value="atap gedung pencakar langit dengan pemandangan kota">Atap gedung, pemandangan kota</option>

                                        </optgroup>

                                         <optgroup label="Fantasi/Fiksi Ilmiah">

                                            <option value="planet alien dengan flora bercahaya">Planet alien, flora bercahaya</option>

                                            <option value="kastil melayang di atas awan">Kastil melayang di awan</option>

                                            <option value="ruang kontrol pesawat luar angkasa futuristik">Ruang kontrol pesawat luar angkasa</option>

                                        </optgroup>

                                    </select>

                                    <div id="customLocationInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan lokasi...">

                                    </div>

                                </div>

                                <div>

                                    <label for="time" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Waktu</label>

                                    <select id="time" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Tidak Ada Waktu Spesifik</option>

                                        <optgroup label="Pagi">

                                            <option value="subuh yang sejuk">Subuh yang Sejuk</option>

                                            <option value="pagi yang cerah">Pagi yang Cerah</option>

                                            <option value="matahari terbit (golden hour)">Matahari Terbit (Golden Hour)</option>

                                        </optgroup>

                                        <optgroup label="Siang">

                                            <option value="siang yang terik">Siang yang Terik</option>

                                            <option value="tengah hari yang panas">Tengah Hari yang Panas</option>

                                        </optgroup>

                                        <optgroup label="Sore">

                                            <option value="sore yang hangat">Sore yang Hangat</option>

                                            <option value="senja (golden hour)">Senja (Golden Hour)</option>

                                            <option value="blue hour setelah matahari terbenam">Blue Hour (Setelah Matahari Terbenam)</option>

                                        </optgroup>

                                        <optgroup label="Malam">

                                            <option value="malam yang sejuk berbintang">Malam yang Sejuk Berbintang</option>

                                            <option value="tengah malam yang sunyi">Tengah Malam yang Sunyi</option>

                                        </optgroup>

                                    </select>

                                    <div id="customTimeInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan waktu...">

                                    </div>

                                </div>

                                <div>

                                    <label for="weather" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Cuaca</label>

                                    <select id="weather" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                         <option value="">Tidak Ada Cuaca Spesifik</option>

                                        <optgroup label="Cerah">

                                            <option value="cerah berkilau">Cerah Berkilau</option>

                                            <option value="matahari bersinar terang">Matahari Bersinar Terang</option>

                                        </optgroup>

                                        <optgroup label="Hujan">

                                            <option value="hujan rintik-rintik">Hujan Rintik-rintik</option>

                                            <option value="hujan deras">Hujan Deras</option>

                                            <option value="badai petir">Badai Petir</option>

                                        </optgroup>

                                         <optgroup label="Berawan">

                                            <option value="berawan lembut">Berawan Lembut</option>

                                            <option value="mendung">Mendung</option>

                                            <option value="langit dramatis berawan tebal">Langit Dramatis Berawan Tebal</option>

                                        </optgroup>

                                        <optgroup label="Khusus">

                                            <option value="angin sepoi-sepoi">Angin Sepoi-sepoi</option>

                                            <option value="angin kencang">Angin Kencang</option>

                                            <option value="berkabut tebal">Berkabut Tebal</option>

                                            <option value="salju turun perlahan">Salju Turun Perlahan</option>

                                        </optgroup>

                                    </select>

                                    <div id="customWeatherInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan cuaca...">

                                    </div>

                                </div>

                                 <div class="md:col-span-2">

                                    <label for="additionalDetails" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Detail Tambahan Lainnya (Opsional)</label>

                                    <textarea id="additionalDetails" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" rows="2" placeholder="Misalnya: warna dominan, objek spesifik di latar belakang, dll."></textarea>

                                </div>

                            </div>

                        </div>



                        <!-- Section 3: Detail Sinematografi -->

                        <div class="p-4 border border-gray-200 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card">

                            <h2 class="form-category-title">3. Detail Sinematografi (Opsional)</h2>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

                                <div>

                                    <label for="style" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Gaya Visual/Video</label>

                                    <select id="style" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Biarkan AI Memilih</option>

                                        <option value="sinematik">Sinematik</option>

                                        <option value="dokumenter">Dokumenter</option>

                                        <option value="anime">Anime</option>

                                        <option value="kartun">Kartun</option>

                                        <option value="realistis">Realistis</option>

                                        <option value="vintage">Vintage</option>

                                        <option value="futuristik">Futuristik</option>

                                        <option value="film noir">Film Noir</option>

                                        <option value="surealis">Surealis</option>

                                        <option value="abstrak">Abstrak</option>

                                        <option value="minimalis">Minimalis</option>

                                    </select>

                                    <div id="customStyleInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan gaya video...">

                                    </div>

                                </div>

                                <div>

                                    <label for="cameraMovement" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Gerakan Kamera</label>

                                    <select id="cameraMovement" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Biarkan AI Memilih</option>

                                        <option value="statik (static)">Statik (Static)</option>

                                        <option value="panning (panning)">Panning</option>

                                        <option value="tilting (tilting)">Tilting</option>

                                        <option value="dolly shot">Dolly Shot</option>

                                        <option value="tracking shot">Tracking Shot</option>

                                        <option value="crane shot">Crane Shot</option>

                                        <option value="handheld">Handheld</option>

                                        <option value="zoom in/out">Zoom In/Out</option>

                                        <option value="slow motion">Slow Motion</option>

                                        <option value="time-lapse">Time-lapse</option>

                                    </select>

                                    <div id="customCameraMovementInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan gerakan kamera...">

                                    </div>

                                </div>

                                <div>

                                    <label for="cameraAngle" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Sudut Kamera</label>

                                    <select id="cameraAngle" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Biarkan AI Memilih</option>

                                        <option value="eye-level shot">Eye-Level Shot</option>

                                        <option value="low angle shot">Low Angle Shot</option>

                                        <option value="high angle shot">High Angle Shot</option>

                                        <option value="bird's eye view">Bird's Eye View</option>

                                        <option value="worm's eye view">Worm's Eye View</option>

                                        <option value="dutch angle / canted angle">Dutch Angle / Canted Angle</option>

                                        <option value="over-the-shoulder shot">Over-the-Shoulder Shot</option>

                                        <option value="point of view (POV) shot">Point of View (POV) Shot</option>

                                    </select>

                                    <div id="customCameraAngleInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan sudut kamera...">

                                    </div>

                                </div>

                                <div>

                                    <label for="focalLength" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Panjang Fokus Lensa</label>

                                    <select id="focalLength" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Biarkan AI Memilih</option>

                                        <option value="lensa wide-angle (mis: 16-35mm)">Lensa Wide-Angle (mis: 16-35mm)</option>

                                        <option value="lensa standar (mis: 35-70mm)">Lensa Standar (mis: 35-70mm)</option>

                                        <option value="lensa telefoto (mis: 70-200mm atau lebih)">Lensa Telefoto (mis: 70-200mm+)</option>

                                        <option value="lensa makro">Lensa Makro</option>

                                        <option value="lensa fisheye">Lensa Fisheye</option>

                                        <option value="shallow depth of field (bokeh)">Shallow Depth of Field (Bokeh)</option>

                                        <option value="deep depth of field">Deep Depth of Field</option>

                                    </select>

                                    <div id="customFocalLengthInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan panjang fokus...">

                                    </div>

                                </div>

                                <div>

                                    <label for="lighting" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Pencahayaan</label>

                                    <select id="lighting" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Biarkan AI Memilih</option>

                                        <option value="cahaya alami (natural light)">Cahaya Alami (Natural Light)</option>

                                        <option value="pencahayaan studio (studio lighting)">Pencahayaan Studio</option>

                                        <option value="golden hour (pagi/sore)">Golden Hour (Pagi/Sore)</option>

                                        <option value="blue hour (setelah matahari terbenam/sebelum terbit)">Blue Hour</option>

                                        <option value="low-key lighting (dramatis, bayangan kuat)">Low-Key Lighting</option>

                                        <option value="high-key lighting (terang, minim bayangan)">High-Key Lighting</option>

                                        <option value="cahaya lembut (soft diffused light)">Cahaya Lembut (Soft Diffused)</option>

                                        <option value="cahaya keras (hard light, bayangan tajam)">Cahaya Keras (Hard Light)</option>

                                        <option value="backlight (cahaya dari belakang subjek)">Backlight</option>

                                        <option value="rim light (cahaya pinggir)">Rim Light</option>

                                        <option value="pencahayaan neon">Pencahayaan Neon</option>

                                    </select>

                                    <div id="customLightingInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan pencahayaan...">

                                    </div>

                                </div>

                                <div>

                                    <label for="colorGrading" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Gradiasi Warna</label>

                                    <select id="colorGrading" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="">Biarkan AI Memilih</option>

                                        <option value="warna alami dan realistis">Warna Alami dan Realistis</option>

                                        <option value="tone hangat (warm tones)">Tone Hangat (Warm Tones)</option>

                                        <option value="tone dingin (cool tones)">Tone Dingin (Cool Tones)</option>

                                        <option value="gaya vintage atau retro">Gaya Vintage atau Retro</option>

                                        <option value="monokrom (hitam putih)">Monokrom (Hitam Putih)</option>

                                        <option value="sepia tone">Sepia Tone</option>

                                        <option value="saturasi tinggi (vibrant colors)">Saturasi Tinggi (Vibrant Colors)</option>

                                        <option value="desaturasi (muted colors)">Desaturasi (Muted Colors)</option>

                                        <option value="kontras tinggi">Kontras Tinggi</option>

                                        <option value="kontras rendah (flat look)">Kontras Rendah (Flat Look)</option>

                                        <option value="teal and orange look">Teal and Orange Look</option>

                                    </select>

                                    <div id="customColorGradingInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan gradiasi warna...">

                                    </div>

                                </div>

                                 <div>

                                    <label for="videoQuality" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Kualitas & Aspek Rasio</label>

                                    <select id="videoQuality" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="HD (16:9)">HD (16:9)</option>

                                        <option value="Full HD (16:9)">Full HD (16:9)</option>

                                        <option value="4K (16:9)">4K (16:9)</option>

                                        <option value="HD Portrait (9:16)">HD Portrait (9:16)</option>

                                        <option value="Full HD Portrait (9:16)">Full HD Portrait (9:16)</option>

                                        <option value="Square (1:1)">Square (1:1)</option>

                                    </select>

                                </div>

                            </div>

                        </div>



                        <!-- Section 4: Detail Audio -->

                        <div class="p-4 border border-gray-200 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card">

                            <h2 class="form-category-title">4. Detail Audio (Opsional)</h2>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

                                <div>

                                    <label for="dialog" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Dialog</label>

                                    <select id="dialog" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="none" selected>Tanpa Dialog</option>

                                        <option value="custom">Input Manual (Untuk Narasi/Dialog Singkat)</option>

                                        <option value="multi_person">Dialog Antar Karakter (Multi-Orang)</option>

                                        <option value="narasi yang informatif">Narasi yang Informatif (Otomatis)</option>

                                        <option value="dialog yang natural">Dialog yang Natural (Otomatis)</option>

                                    </select>

                                    <div id="customDialogInput" class="hidden mt-2 space-y-2">

                                        <input type="text" class="custom-dialog-text-input w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan narasi atau dialog singkat...">

                                        <div>

                                            <label for="customDialogLanguage" class="block text-xs font-medium text-gray-600 dark:text-dark-text-secondary mb-1">Bahasa Dialog Manual:</label>

                                            <select id="customDialogLanguage" class="w-full px-3 py-1.5 border rounded-md focus:outline-none select-field text-xs">

                                                <option value="Bahasa Indonesia" selected>Bahasa Indonesia</option>

                                                <option value="English">English</option>

                                                <option value="Bahasa Jawa">Bahasa Jawa</option>

                                                <option value="Bahasa Sunda">Bahasa Sunda</option>

                                                <option value="Bahasa Malaysia">Bahasa Malaysia</option>

                                                <option value="Bahasa Lainnya">Bahasa Lainnya (Sebutkan)</option>

                                            </select>

                                            <input type="text" id="customDialogLanguageOther" class="hidden w-full mt-1 px-3 py-1.5 border rounded-md focus:outline-none input-field text-xs" placeholder="Sebutkan bahasa lainnya...">

                                        </div>

                                    </div>

                                    <div id="multiPersonDialogContainer" class="hidden mt-3 space-y-3">

                                        <!-- Speaker entries will be added here by JavaScript -->

                                        <button type="button" id="addSpeakerButton" class="mt-2 text-sm text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300 font-medium flex items-center">

                                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>

                                            Tambah Pembicara

                                        </button>

                                    </div>

                                </div>

                                <div>

                                    <label for="backgroundMusic" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Musik Latar</label>

                                    <select id="backgroundMusic" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="none" selected>Tanpa Musik</option>

                                        <optgroup label="Genre">

                                            <option value="instrumental yang elegan">Instrumental yang Elegan</option>

                                            <option value="pop yang energik">Pop yang Energik</option>

                                        </optgroup>

                                        <optgroup label="Suasana">

                                            <option value="dramatis yang intens">Dramatis yang Intens</option>

                                        </optgroup>

                                    </select>

                                     <div id="customMusicInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan musik...">

                                    </div>

                                </div>

                                 <div>

                                    <label for="soundEffects" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Efek Suara</label>

                                    <select id="soundEffects" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="custom">Input Manual</option>

                                        <option value="none" selected>Tanpa Efek</option>

                                        <optgroup label="Alam">

                                            <option value="suara hujan menyejukkan">Suara Hujan Menyejukkan</option>

                                            <option value="suara angin sepoi-sepoi">Suara Angin Sepoi-sepoi</option>

                                        </optgroup>

                                    </select>

                                     <div id="customSoundEffectsInput" class="hidden mt-2">

                                        <input type="text" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" placeholder="Deskripsikan efek suara...">

                                    </div>

                                </div>

                                <div>

                                    <label for="audioTranslation" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Terjemahan Audio (Jika ada dialog)</label>

                                    <select id="audioTranslation" class="w-full px-3 py-2 border rounded-md focus:outline-none select-field">

                                        <option value="none" selected>Tanpa Terjemahan</option>

                                        <option value="english_subtitle">Subtitle Inggris (Dialog Asli)</option>

                                        <option value="english_voiceover">Alih Suara ke Bahasa Inggris</option>

                                    </select>

                                </div>

                            </div>

                             <div class="mt-6 p-4 border border-gray-200 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card">

                                <div class="flex items-center justify-between cursor-pointer" onclick="toggleAudioMixing()">

                                    <h3 class="text-md font-semibold text-gray-700 dark:text-dark-text-secondary">Pengaturan Volume Audio (Jika ada audio)</h3>

                                    <svg id="audioMixingChevron" class="w-5 h-5 text-gray-500 dark:text-dark-text-secondary transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>

                                </div>

                                <div id="audioMixingContent" class="hidden mt-4 space-y-3">

                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                                        <div>

                                            <label for="dialogVolume" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary">Volume Dialog: <span id="dialogVolumeValue" class="font-normal text-purple-600 dark:text-purple-400">80%</span></label>

                                            <input type="range" id="dialogVolume" min="0" max="100" value="80" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer range-slider">

                                        </div>

                                        <div>

                                            <label for="musicVolume" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary">Volume Musik: <span id="musicVolumeValue" class="font-normal text-purple-600 dark:text-purple-400">60%</span></label>

                                            <input type="range" id="musicVolume" min="0" max="100" value="60" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer range-slider">

                                        </div>

                                        <div>

                                            <label for="effectsVolume" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary">Volume Efek: <span id="effectsVolumeValue" class="font-normal text-purple-600 dark:text-purple-400">40%</span></label>

                                            <input type="range" id="effectsVolume" min="0" max="100" value="40" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer range-slider">

                                        </div>

                                        <div>

                                            <label for="overallVolume" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary">Volume Master: <span id="overallVolumeValue" class="font-normal text-purple-600 dark:text-purple-400">100%</span></label>

                                            <input type="range" id="overallVolume" min="0" max="100" value="100" class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer range-slider">

                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>



                        <!-- Section 5: Negative Prompt (Untuk Gambar) -->

                        <div class="p-4 border border-gray-200 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card">

                            <h2 class="form-category-title">5. Detail Negatif (Untuk Gambar, Opsional)</h2>

                            <div>

                                <label for="negativePrompt" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Hal yang Dihindari (Negative Prompt)</label>

                                <textarea id="negativePrompt" class="w-full px-3 py-2 border rounded-md focus:outline-none input-field" rows="3" placeholder="Contoh: teks, watermark, kualitas buruk, blur, terlalu banyak jari, warna jelek"></textarea>

                                <p class="text-xs text-gray-500 dark:text-dark-text-secondary mt-1">Masukkan kata kunci atau deskripsi hal-hal yang tidak Anda inginkan muncul pada gambar.</p>

                            </div>

                        </div>

                        

                         <input type="hidden" id="equalizer" value="none">

                        <input type="hidden" id="compression" value="none">

                        <input type="hidden" id="reverb" value="none">

                        <input type="hidden" id="spatialAudio" value="none">

                        <input type="hidden" id="showAudioMixing" value="false"> 

                        <input type="hidden" id="showAudioProcessing" value="false">

                        <input type="hidden" id="dialogCharacter" value="none"> 

                        <input type="hidden" id="voiceMood" value="none"> 

                        <input type="hidden" id="volume" value="sedang yang seimbang"> 



                        <!-- Input Validation/Suggestion Area -->

                        <div id="inputSuggestions" class="p-3 bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-md text-sm text-blue-700 dark:text-blue-300 min-h-[40px]">

                            <!-- Pesan validasi/saran akan muncul di sini -->

                        </div>



                        <!-- Action Buttons -->

                        <div class="pt-4 space-y-3">

                             <div class="flex space-x-3">

                                <button type="submit" id="generatePromptButton" class="flex-1 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">

                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path></svg>

                                    Buat Prompt Profesional

                                </button>

                                <button type="button" id="regeneratePromptButton" class="flex-shrink-0 bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center" title="Generate Ulang Prompt dengan Input Saat Ini">

                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2A8.001 8.001 0 0019.418 15m0 0H15"></path></svg>

                                </button>

                            </div>

                            <div class="flex space-x-3">

                                <button type="button" id="resetButton" class="w-1/2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-700 dark:text-dark-text font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center">

                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2A8.001 8.001 0 0019.418 15m0 0H15"></path></svg>

                                    Reset Semua Input

                                </button>

                                <button type="button" id="clearPromptButton" class="w-1/2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-700 dark:text-dark-text font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center">

                                     <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>

                                    Hapus Prompt (Live)

                                </button>

                            </div>

                        </div>

                    </form>

                </div>

            </div>



            <!-- Output and History Section -->

            <div class="w-full lg:w-[500px] space-y-6">

                <div class="card rounded-xl p-6">

                    <div class="flex justify-between items-center mb-3">

                        <h2 class="text-lg font-semibold text-gray-700 dark:text-dark-text-secondary">Prompt Profesional Indonesia</h2>

                        <button type="button" class="copy-btn-output text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-xs font-medium flex items-center gap-1 px-2 py-1 rounded border border-blue-200 dark:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-700 transition-colors" data-target="generatedPrompt">

                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>

                            Salin

                        </button>

                    </div>

                    <div id="generatedPrompt" class="bg-gray-50 dark:bg-dark-input-bg p-4 rounded-md border border-gray-200 dark:border-dark-input-border min-h-[200px] max-h-[calc(33vh-100px)] overflow-y-auto text-sm text-gray-700 dark:text-dark-text whitespace-pre-line">

                        <p class="text-gray-500 dark:text-dark-text-secondary">Prompt Bahasa Indonesia akan muncul di sini...</p>

                    </div>

                </div>

                <div class="card rounded-xl p-6">

                     <div class="flex justify-between items-center mb-3">

                        <h2 class="text-lg font-semibold text-gray-700 dark:text-dark-text-secondary">Professional English Prompt</h2>

                        <button type="button" class="copy-btn-output text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 text-xs font-medium flex items-center gap-1 px-2 py-1 rounded border border-green-200 dark:border-green-500 hover:bg-green-50 dark:hover:bg-green-700 transition-colors" data-target="generatedPromptEnglish">

                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>

                            Copy

                        </button>

                    </div>

                    <div id="generatedPromptEnglish" class="bg-gray-50 dark:bg-dark-input-bg p-4 rounded-md border border-gray-200 dark:border-dark-input-border min-h-[200px] max-h-[calc(33vh-100px)] overflow-y-auto text-sm text-gray-700 dark:text-dark-text whitespace-pre-line">

                        <p class="text-gray-500 dark:text-dark-text-secondary">Professional English prompt will appear here...</p>

                    </div>

                </div>

                <div class="card rounded-xl p-6">

                    <div class="flex justify-between items-center mb-3">

                        <h2 class="text-lg font-semibold text-gray-700 dark:text-dark-text-secondary">Riwayat Prompt</h2>

                        <button type="button" id="clearHistoryButton" class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-xs font-medium flex items-center gap-1 px-2 py-1 rounded border border-red-200 dark:border-red-500 hover:bg-red-50 dark:hover:bg-red-700 transition-colors">

                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>

                            Bersihkan Riwayat

                        </button>

                    </div>

                    <div id="promptHistoryContainer" class="bg-gray-50 dark:bg-dark-input-bg p-4 rounded-md border border-gray-200 dark:border-dark-input-border min-h-[150px] max-h-[calc(34vh-100px)] overflow-y-auto text-sm text-gray-700 dark:text-dark-text space-y-3">

                        <p class="text-gray-400 dark:text-dark-text-secondary italic">Riwayat prompt akan muncul di sini...</p>

                    </div>

                </div>

            </div>

        </div>

    </div>



    <!-- API Key Modal -->

    <div id="apiKeyModal" class="modal-overlay">

        <div class="modal-content"> <!-- dark:bg-dark-card dark:border-dark-border already handled by .dark .card style -->

            <div class="flex justify-between items-center mb-4">

                <h2 class="text-xl font-semibold text-gray-800 dark:text-dark-text">Setup API Key untuk Free Unlimited</h2>

                <button id="closeApiKeyModal" class="text-gray-500 hover:text-gray-700 dark:text-dark-text-secondary dark:hover:text-white">

                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>

                </button>

            </div>



            <div class="mb-4 p-3 bg-green-light dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-md">

                <h3 class="text-md font-semibold text-green-700 dark:text-green-300 mb-1">✨ Free Unlimited dengan API Key Gemini</h3>

                <p class="text-sm text-green-600 dark:text-green-400">Gunakan API Key Gemini Anda sendiri untuk mendapat unlimited prompts gratis selamanya! Tidak ada batasan harian, tidak ada biaya berlangganan.</p>

                <ul class="list-disc list-inside text-xs text-green-500 dark:text-green-500 mt-2 space-y-1">

                    <li>100% gratis dari Google AI Studio</li>

                    <li>Unlimited prompts tanpa batas</li>

                    <li>Data aman, API key tersimpan lokal</li>

                    <li>Response cepat langsung dari Gemini</li>

                </ul>

            </div>



            <div class="mb-4">

                <label for="geminiApiKeyInput" class="block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1">Masukkan API Key Gemini Anda</label>

                <input type="password" id="geminiApiKeyInput" class="w-full px-3 py-2 border border-gray-300 dark:border-dark-input-border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 input-field" placeholder="AIza...">

                <p class="text-xs text-gray-500 dark:text-dark-text-secondary mt-1">Dapatkan gratis di <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">Google AI Studio <svg class="inline w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a></p>

            </div>



            <button id="saveApiKeyButton" class="w-full bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-150 flex items-center justify-center mb-6">

                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>

                Simpan & Aktifkan Free Unlimited

            </button>



            <div class="border-t border-gray-200 dark:border-dark-border pt-4">

                <h3 class="text-md font-semibold text-gray-700 dark:text-dark-text-secondary mb-2">Tutorial Lengkap Setup API Key:</h3>

                <a href="https://www.youtube.com/watch?v=YOUR_YOUTUBE_TUTORIAL_ID" target="_blank" class="block w-full bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-150 flex items-center justify-center mb-3">

                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>

                    Tonton Tutorial YouTube

                </a>

                <p class="text-sm font-medium text-gray-600 dark:text-dark-text-secondary mb-1">Langkah Detail Setup:</p>

                <ol class="list-decimal list-inside text-xs text-gray-500 dark:text-dark-text-secondary space-y-1">

                    <li>Buka Google AI Studio: <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">Klik link ini</a></li>

                    <li>Login Google: Masuk dengan akun Google</li>

                    <li>Create API Key: Klik tombol "Create API Key"</li>

                    <li>Pilih Project: Pilih atau buat project baru</li>

                    <li>Copy Key: Copy kode "AIza..."</li>

                    <li>Paste di Sini: Masukkan di form di atas</li>

                    <li>Klik Simpan: Klik tombol hijau di atas</li>

                    <li>Selesai: Unlimited prompts aktif!</li>

                </ol>

            </div>

             <div id="apiKeySuccessMessage" class="hidden mt-4 p-3 bg-green-light dark:bg-green-900 border border-green-300 dark:border-green-700 rounded-md text-sm text-green-700 dark:text-green-300">

                <p>✅ <strong>Setup berhasil:</strong> API Key Gemini Anda telah disimpan dan diaktifkan!</p>

                <p class="text-xs">API key disimpan aman di browser Anda, tidak dikirim ke server manapun kecuali saat request ke Gemini.</p>

            </div>

            <div id="apiKeyErrorMessage" class="hidden mt-4 p-3 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 rounded-md text-sm text-red-700 dark:text-red-300">

                <p>❌ <strong>Setup Gagal:</strong> API Key tidak valid atau terjadi kesalahan. Silakan periksa kembali.</p>

            </div>

        </div>

    </div>



    <!-- Toast Notification Placeholder -->

    <div id="toastNotification" class="toast-notification">Pesan Toast!</div>





    <script type="module">

        const GEMINI_API_ENDPOINT_BASE = 'https://generativelanguage.googleapis.com/v1beta/models/';

        const API_KEY_STORAGE_KEY = 'geminiApiKey';

        const API_KEY_TYPE_STORAGE_KEY = 'geminiApiKeyType'; 

        const SHARED_API_KEY = "AIzaSyBXLRt1DizlFrqJ68lIQNFrc-cirx1MHTQ"; 

        const PROMPT_HISTORY_STORAGE_KEY = 'promptGeneratorHistory_v1';

        const MAX_HISTORY_ITEMS = 10; 

        const DARK_MODE_STORAGE_KEY = 'promptGeneratorDarkMode'; 



        const PRIMARY_GEMINI_MODEL = 'gemini-2.0-flash';

        const FALLBACK_GEMINI_MODELS = ['gemini-1.5-flash-latest', 'gemini-pro']; 



        const GEMINI_MODELS_FOR_TRANSLATION = [PRIMARY_GEMINI_MODEL, ...FALLBACK_GEMINI_MODELS];

        const GEMINI_MODELS_FOR_REFINEMENT = [PRIMARY_GEMINI_MODEL, ...FALLBACK_GEMINI_MODELS];

        const GEMINI_MODELS_FOR_REGIONAL_TRANSLATION = [PRIMARY_GEMINI_MODEL, ...FALLBACK_GEMINI_MODELS];





        const apiKeyStatusIcon = document.getElementById('apiKeyStatusIcon');

        const apiKeyStatusText = document.getElementById('apiKeyStatusText');

        const apiKeyInfoText = document.getElementById('apiKeyInfoText');

        const generatePromptButton = document.getElementById('generatePromptButton');

        const regeneratePromptButton = document.getElementById('regeneratePromptButton'); 

        const setupApiKeyButtonText = document.getElementById('setupApiKeyButtonText');

        const sharedApiKeyDisplay = document.getElementById('sharedApiKeyDisplay'); 

        const copySharedApiKeyButton = document.getElementById('copySharedApiKeyButton'); 

        const dialogSelect = document.getElementById('dialog');

        const customDialogInputDiv = document.getElementById('customDialogInput');

        const multiPersonDialogContainer = document.getElementById('multiPersonDialogContainer');

        const addSpeakerButton = document.getElementById('addSpeakerButton');

        const promptHistoryContainer = document.getElementById('promptHistoryContainer');

        const clearHistoryButton = document.getElementById('clearHistoryButton');

        const toastNotification = document.getElementById('toastNotification');

        const customDialogLanguageSelect = document.getElementById('customDialogLanguage'); 

        const customDialogLanguageOtherInput = document.getElementById('customDialogLanguageOther'); 

        const inputSuggestionsDiv = document.getElementById('inputSuggestions'); // New





        // Dark Mode Elements

        const darkModeToggle = document.getElementById('darkModeToggle');

        const sunIcon = document.getElementById('sunIcon');

        const moonIcon = document.getElementById('moonIcon');





        function getApiKey() {

            return localStorage.getItem(API_KEY_STORAGE_KEY);

        }

        function getApiKeyType() {

            return localStorage.getItem(API_KEY_TYPE_STORAGE_KEY);

        }



        function saveApiKey(key, type = "pribadi") { 

            localStorage.setItem(API_KEY_STORAGE_KEY, key);

            localStorage.setItem(API_KEY_TYPE_STORAGE_KEY, type);

            updateApiKeyStatusUI(true, type);

        }

        

        function clearApiKey() { 

            localStorage.removeItem(API_KEY_STORAGE_KEY);

            localStorage.removeItem(API_KEY_TYPE_STORAGE_KEY);

            updateApiKeyStatusUI(false);

        }



        function showToast(message, duration = 3000) {

            if (!toastNotification) return;

            toastNotification.textContent = message;

            toastNotification.classList.add('show');

            setTimeout(() => {

                toastNotification.classList.remove('show');

            }, duration);

        }



        function updateApiKeyStatusUI(isKeySet, keyType = "pribadi") {

            if (isKeySet) {

                apiKeyStatusIcon.classList.remove('text-red-500');

                apiKeyStatusIcon.classList.add('text-green-500');

                apiKeyStatusIcon.innerHTML = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`;

                apiKeyStatusText.textContent = `API Key Aktif (${keyType === "gratis_bersama" ? "Gratis Bersama" : "Pribadi"})`;

                apiKeyStatusText.classList.remove('text-red-700', 'bg-red-100', 'border-red-300');

                apiKeyStatusText.classList.add('text-green-700', 'bg-green-100', 'border-green-300');

                apiKeyInfoText.textContent = 'Anda siap menggunakan generator dengan API Key Gemini Anda.';

                if (generatePromptButton) generatePromptButton.disabled = false;

                if (regeneratePromptButton) regeneratePromptButton.disabled = false; 

                if(setupApiKeyButtonText) setupApiKeyButtonText.textContent = "Ganti API Key Pribadi";



            } else {

                apiKeyStatusIcon.classList.remove('text-green-500');

                apiKeyStatusIcon.classList.add('text-red-500');

                apiKeyStatusIcon.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;

                apiKeyStatusText.textContent = 'API Key Belum Diatur';

                apiKeyStatusText.classList.remove('text-green-700', 'bg-green-100', 'border-green-300');

                apiKeyStatusText.classList.add('text-red-700', 'bg-red-100', 'border-red-300');

                apiKeyInfoText.textContent = 'Untuk menggunakan generator, Anda wajib menghubungkan API Key Gemini Anda atau gunakan API Key Gratis dari kami.';

                if (generatePromptButton) generatePromptButton.disabled = true;

                if (regeneratePromptButton) regeneratePromptButton.disabled = true; 

                if(setupApiKeyButtonText) setupApiKeyButtonText.textContent = "Setup API Key Pribadi";

            }

        }



        async function callGeminiAPI(apiKey, modelsToTry, promptText, taskName = "operasi") {

            let lastError = null;

            let usedModel = modelsToTry[0]; 



            for (const model of modelsToTry) {

                const endpoint = `${GEMINI_API_ENDPOINT_BASE}${model}:generateContent?key=${apiKey}`;

                const requestBody = {

                    "contents": [{"parts": [{"text": promptText}]}]

                };

                try {

                    console.log(`Mencoba ${taskName} dengan model: ${model}`);

                    const response = await fetch(endpoint, {

                        method: 'POST',

                        headers: {'Content-Type': 'application/json'},

                        body: JSON.stringify(requestBody),

                    });



                    if (response.ok) {

                        const data = await response.json();

                        console.log(`Respon sukses dari ${model} untuk ${taskName}:`, data);

                        if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {

                            let refinedText = data.candidates[0].content.parts[0].text;

                            refinedText = refinedText.replace(/\*+/g, ''); 

                            refinedText = refinedText.replace(/^\s*>>>\s*|\s*>>>\s*$/g, "").trim();





                            if (model !== modelsToTry[0]) { 

                                showToast(`Menggunakan model alternatif (${model}) untuk ${taskName}.`, 4000);

                                console.warn(`Sukses dengan model fallback: ${model} untuk ${taskName}. Model utama (${modelsToTry[0]}) mungkin overload.`);

                            }

                            usedModel = model;

                            return { success: true, data: refinedText, error: null, usedModel: usedModel };

                        } else if (data.promptFeedback && data.promptFeedback.blockReason) {

                             lastError = `Prompt diblokir oleh ${model} untuk ${taskName}. Alasan: ${data.promptFeedback.blockReason}. Detail: ${data.promptFeedback.safetyRatings.map(r => `${r.category} - ${r.probability}`).join(', ')}`;

                             return { success: false, data: null, error: lastError, usedModel: model };

                        }

                        lastError = `Tidak ada konten dalam respon dari ${model} untuk ${taskName} atau format tidak terduga.`;

                    } else { 

                        const errorData = await response.json();

                        console.error(`Error API Gemini (${model} untuk ${taskName}):`, errorData);

                        lastError = `Error ${response.status} dari ${model} untuk ${taskName}: ${errorData.error?.message || response.statusText}.`;



                        if (response.status === 503) { 

                            console.warn(`Model ${model} overload untuk ${taskName}, mencoba model berikutnya jika ada...`);

                            if (modelsToTry.indexOf(model) < modelsToTry.length - 1) {

                                continue; 

                            } else {

                                return { success: false, data: null, error: `Semua model (${modelsToTry.join(', ')}) overload atau gagal untuk ${taskName}. Error terakhir: ${lastError}`, usedModel: model };

                            }

                        } else if (response.status === 400 && errorData.error && errorData.error.message.toLowerCase().includes("api key not valid")) {

                            clearApiKey();

                            return { success: false, data: null, error: "API Key tidak valid. Silakan periksa kembali atau ganti API Key Anda.", usedModel: model };

                        } else if (response.status === 429) {

                            return { success: false, data: null, error: `Terlalu banyak permintaan ke API (${model}) untuk ${taskName}. Coba lagi nanti.`, usedModel: model };

                        }

                        return { success: false, data: null, error: lastError, usedModel: model };

                    }

                } catch (error) { 

                    console.error(`Error jaringan atau lainnya saat pemanggilan API (${model} untuk ${taskName}):`, error);

                    lastError = `Error jaringan dengan ${model} untuk ${taskName}: ${error.message}. Periksa konsol.`;

                    if (modelsToTry.indexOf(model) === modelsToTry.length - 1 || !navigator.onLine) {

                        return { success: false, data: null, error: lastError, usedModel: model };

                    }

                    console.warn(`Gagal dengan ${model}, mencoba model berikutnya untuk ${taskName}...`);

                }

            }

            return { success: false, data: null, error: lastError || `Semua model yang dicoba (${modelsToTry.join(', ')}) gagal untuk ${taskName}.`, usedModel: modelsToTry[modelsToTry.length - 1] };

        }





        const promptHandler = {

            refinePrompt: async (subject, action, apiKey, promptPurpose, outputMediaType) => {

                if (!apiKey) return { success: false, data: null, error: "API Key is missing for prompt refinement." };

                

                let baseInstruction = `Anda adalah asisten pembuatan prompt yang ahli. Berdasarkan Subjek dan Aksi berikut, buatlah prompt dalam Bahasa Indonesia yang detail dan deskriptif. Hindari penggunaan markdown atau karakter khusus seperti asterisk (*) untuk penekanan; gunakan bahasa alami yang mengalir.`;



                if (outputMediaType === "video") {

                    baseInstruction += ` Fokus pada pembuatan prompt untuk video (misalnya untuk Veo 3), sertakan detail visual sinematik seperti jenis shot (misalnya, establishing shot, close-up), pergerakan kamera, sudut kamera, parameter lensa jika relevan, pencahayaan (misalnya, golden hour), dan gradasi warna.`;

                } else if (outputMediaType === "gambar") {

                    baseInstruction += ` Fokus pada pembuatan prompt untuk gambar (text-to-image), sertakan detail visual yang kaya, komposisi, gaya seni jika relevan, pencahayaan, dan palet warna. Hindari penyebutan pergerakan kamera kecuali jika sangat relevan untuk adegan statis.`;

                }



                let purposeSpecifics = "";

                switch (promptPurpose) {

                    case "video_sinematik": purposeSpecifics = "Tujuan utama adalah video sinematik yang imersif."; break;

                    case "gambar_realistis": purposeSpecifics = "Tujuan utama adalah gambar fotorealistik."; break;

                    case "gambar_seni_digital": purposeSpecifics = "Tujuan utama adalah gambar seni digital dengan gaya tertentu (misalnya, fantasi, surealis, abstrak)."; break;

                    case "iklan_produk": purposeSpecifics = "Tujuan utama adalah iklan produk yang menarik dan persuasif, menonjolkan produk (subjek)."; break;

                    case "konten_medsos": purposeSpecifics = "Tujuan utama adalah konten media sosial yang singkat, menarik perhatian, dan mudah dicerna."; break;

                    case "presentasi_edukasi": purposeSpecifics = "Tujuan utama adalah visual pendukung untuk presentasi atau materi edukasi yang jelas dan informatif."; break;

                    case "podcast_visual": purposeSpecifics = "Tujuan utama adalah visual pendukung yang atmosferik untuk podcast audio."; break;

                    case "konsep_game": purposeSpecifics = "Tujuan utama adalah konsep seni untuk game, menggambarkan karakter, lingkungan, atau adegan penting."; break;

                    case "lainnya": purposeSpecifics = "Tujuan prompt akan dijelaskan lebih lanjut dalam detail tambahan."; break;

                }



                const refinementInstruction = `${baseInstruction} ${purposeSpecifics}



Subjek: "${subject}"

Aksi: "${action}"



Contoh output yang diinginkan (hanya sebagai referensi gaya, jangan meniru persis dan JANGAN GUNAKAN ASTERISK, sesuaikan dengan kebutuhan output video atau gambar):

'${outputMediaType === "video" ? "Sebuah naga perkasa terbang tinggi di angkasa. Shot establishing dari wide angle lens (24mm, f/8) menangkap seluruh cakrawala, dengan naga sebagai titik fokus dinamis di tengah frame. Pencahayaan golden hour memberikan backlight dramatis, menyoroti siluet naga dan tekstur sisiknya. Color grading hangat dengan sentuhan teal di langit untuk menciptakan kontras visual yang menarik." : "Sebuah lukisan digital detail tinggi menampilkan naga perkasa dengan sisik berwarna merah menyala, terbang melintasi langit senja yang dramatis dengan awan berwarna ungu dan oranye. Fokus tajam pada mata naga yang bersinar, tekstur sisik terlihat jelas. Gaya seni fantasi epik."}'



Prompt (Bahasa Indonesia):`;

                return await callGeminiAPI(apiKey, GEMINI_MODELS_FOR_REFINEMENT, refinementInstruction, "penyempurnaan prompt");

            },

            translateText: async (text, apiKey) => { // For main prompt to English

                if (!apiKey) return { success: false, data: null, error: "API Key is missing for translation." };

                const translationInstruction = `

Translate the following text from Indonesian to English.

Follow these rules strictly:

1. The English translation must be proficient and natural-sounding.

2. Maintain the original paragraph structure and line breaks from the source text.

3. Preserve all placeholders exactly as they appear (e.g., "(Volume: X%)", "[Product Name]", "(Durasi: HH:MM:SS)", "(Resolusi: WxH)").

4. Translate technical terms to their common English equivalents.

5. Avoid overly literal translations of connecting words; use natural English phrasing.

6. CRITICAL: Your output MUST contain ONLY the translated English text. Do NOT include the original Indonesian text, any part of these instructions, or any introductory/concluding phrases like "Here is the translation:", "English Translation:", or any delimiters like ">>>".



Indonesian Text to Translate:

${text.trim()}



English Translation:`;

                return await callGeminiAPI(apiKey, GEMINI_MODELS_FOR_TRANSLATION, translationInstruction, "penerjemahan ke English");

            },

            translateDialogLine: async (text, targetLanguage, apiKey, sourceLanguage = "Bahasa Indonesia") => { // For dialog lines to regional/other languages

                if (!apiKey) return { success: false, data: text, error: "API Key is missing for dialog translation." }; 

                if (!text || !targetLanguage) return { success: false, data: text, error: "Text or target language is missing for dialog translation." };



                if (targetLanguage.toLowerCase().includes('indonesia') || targetLanguage.toLowerCase() === 'english') {

                    return { success: true, data: text, error: null, usedModel: 'N/A (No translation needed for this line)' };

                }



                const translationInstruction = `

Translate the following text from ${sourceLanguage} to ${targetLanguage}.

Instruction: Output ONLY the translated text. Do not include any of the original text, these instructions, or any conversational phrases.



${sourceLanguage} Text:

${text.trim()}



${targetLanguage} Translation:`;

                return await callGeminiAPI(apiKey, GEMINI_MODELS_FOR_REGIONAL_TRANSLATION, translationInstruction, `penerjemahan dialog ke ${targetLanguage}`);

            }

        };

        

        function getElementValue(id, defaultValue = '') { return document.getElementById(id) ? document.getElementById(id).value : defaultValue; }

        function getCustomInputValue(selector, defaultValue = '') { const el = document.querySelector(selector); return el ? (el.value.trim() || defaultValue) : defaultValue; }

        function updateVolumeDisplay(inputId, displayId) { const i = document.getElementById(inputId), d = document.getElementById(displayId); if (i && d) d.textContent = i.value + '%'; }

        window.toggleAudioMixing = function() { const c = document.getElementById('audioMixingContent'), v = document.getElementById('audioMixingChevron'); c.classList.toggle('hidden'); v.classList.toggle('rotate-180'); document.getElementById('showAudioMixing').value = !c.classList.contains('hidden').toString(); };



        function addSpeakerEntry(speakerData = null) { 

            const speakerId = speakerData ? speakerData.id : Date.now(); 

            const entryDiv = document.createElement('div');

            entryDiv.classList.add('speaker-entry', 'p-3', 'rounded-md', 'bg-purple-50', 'dark:bg-dark-input-bg', 'space-y-2');

            entryDiv.dataset.speakerId = speakerId; 



            entryDiv.innerHTML = `

                <div class="flex items-center justify-between">

                    <label for="speakerName_${speakerId}" class="block text-xs font-medium text-gray-600 dark:text-dark-text-secondary">Nama Pembicara</label>

                    <button type="button" class="remove-speaker-btn text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-xs">

                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>

                    </button>

                </div>

                <input type="text" id="speakerName_${speakerId}" class="speaker-name w-full px-2 py-1.5 border border-purple-200 dark:border-purple-700 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-purple-400 input-field" placeholder="Contoh: Narator, Alex, Siti" value="${speakerData ? speakerData.name : ''}">

                

                <div class="mt-1">

                    <label for="speakerDialogLanguage_${speakerId}" class="block text-xs font-medium text-gray-600 dark:text-dark-text-secondary mb-0.5">Bahasa Dialog:</label>

                    <select id="speakerDialogLanguage_${speakerId}" class="speaker-dialog-language w-full px-2 py-1 border border-purple-200 dark:border-purple-700 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-purple-400 select-field">

                        <option value="Bahasa Indonesia">Bahasa Indonesia</option>

                        <option value="English">English</option>

                        <option value="Bahasa Jawa">Bahasa Jawa</option>

                        <option value="Bahasa Sunda">Bahasa Sunda</option>

                        <option value="Bahasa Malaysia">Bahasa Malaysia</option>

                        <option value="Bahasa Lainnya">Bahasa Lainnya (Sebutkan)</option>

                    </select>

                    <input type="text" id="speakerDialogLanguageOther_${speakerId}" class="speaker-dialog-language-other hidden w-full mt-1 px-2 py-1 border border-purple-200 dark:border-purple-700 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-purple-400 input-field" placeholder="Sebutkan bahasa lainnya..." value="${speakerData && speakerData.language === 'Bahasa Lainnya' ? speakerData.otherLanguage : ''}">

                </div>



                <label for="speakerDialog_${speakerId}" class="block text-xs font-medium text-gray-600 dark:text-dark-text-secondary mt-1">Baris Dialog (Ketik dalam Bahasa Indonesia atau Inggris untuk diterjemahkan):</label>

                <textarea id="speakerDialog_${speakerId}" class="speaker-dialog w-full px-2 py-1.5 border border-purple-200 dark:border-purple-700 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-purple-400 input-field" rows="2" placeholder="Masukkan dialog di sini...">${speakerData ? speakerData.dialog : ''}</textarea>

            `;

            multiPersonDialogContainer.insertBefore(entryDiv, addSpeakerButton);

            

            const langSelect = entryDiv.querySelector(`#speakerDialogLanguage_${speakerId}`);

            const langOtherInput = entryDiv.querySelector(`#speakerDialogLanguageOther_${speakerId}`);



            if (speakerData) { 

                langSelect.value = speakerData.language;

                if (speakerData.language === 'Bahasa Lainnya') {

                    langOtherInput.classList.remove('hidden');

                }

            } else {

                 langSelect.value = 'Bahasa Indonesia'; 

            }





            langSelect.addEventListener('change', function() {

                langOtherInput.classList.toggle('hidden', this.value !== 'Bahasa Lainnya');

                if (this.value !== 'Bahasa Lainnya') {

                    langOtherInput.value = '';

                }

            });



            entryDiv.querySelector('.remove-speaker-btn').addEventListener('click', () => {

                entryDiv.remove();

            });

        }

        

        function savePromptToHistory(indonesianPrompt, englishPrompt) {

            let history = JSON.parse(localStorage.getItem(PROMPT_HISTORY_STORAGE_KEY)) || [];

            const timestamp = new Date().toLocaleString('id-ID', { dateStyle: 'short', timeStyle: 'short' });

            history.unshift({ indonesianPrompt, englishPrompt, timestamp }); 

            if (history.length > MAX_HISTORY_ITEMS) {

                history = history.slice(0, MAX_HISTORY_ITEMS); 

            }

            localStorage.setItem(PROMPT_HISTORY_STORAGE_KEY, JSON.stringify(history));

            loadPromptHistory(); 

        }



        function loadPromptHistory() {

            const history = JSON.parse(localStorage.getItem(PROMPT_HISTORY_STORAGE_KEY)) || [];

            promptHistoryContainer.innerHTML = ''; 



            if (history.length === 0) {

                promptHistoryContainer.innerHTML = '<p class="text-gray-400 dark:text-dark-text-secondary italic">Riwayat prompt akan muncul di sini...</p>';

                if(clearHistoryButton) clearHistoryButton.classList.add('hidden');

                return;

            }

            if(clearHistoryButton) clearHistoryButton.classList.remove('hidden');



            history.forEach((item, index) => {

                const historyItemDiv = document.createElement('div');

                historyItemDiv.classList.add('p-3', 'border', 'border-gray-200', 'dark:border-dark-border', 'rounded-md', 'bg-white', 'dark:bg-dark-card', 'shadow-sm', 'hover:shadow-md', 'transition-shadow');

                historyItemDiv.innerHTML = `

                    <p class="text-xs text-gray-400 dark:text-dark-text-secondary mb-1">${item.timestamp}</p>

                    <p class="font-medium text-xs text-purple-700 dark:text-purple-400 mb-1">Indonesia:</p>

                    <p class="text-xs text-gray-600 dark:text-dark-text mb-2 whitespace-pre-line break-words">${item.indonesianPrompt.substring(0,150)}${item.indonesianPrompt.length > 150 ? '...' : ''}</p>

                    <p class="font-medium text-xs text-green-700 dark:text-green-400 mb-1">English:</p>

                    <p class="text-xs text-gray-600 dark:text-dark-text mb-2 whitespace-pre-line break-words">${item.englishPrompt.substring(0,150)}${item.englishPrompt.length > 150 ? '...' : ''}</p>

                    <div class="mt-2 flex gap-2">

                        <button class="copy-history-btn text-xs bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-700 dark:text-blue-100 dark:hover:bg-blue-600 px-2 py-1 rounded-md" data-type="indonesian" data-index="${index}">Salin ID</button>

                        <button class="copy-history-btn text-xs bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-700 dark:text-green-100 dark:hover:bg-green-600 px-2 py-1 rounded-md" data-type="english" data-index="${index}">Salin EN</button>

                    </div>

                `;

                promptHistoryContainer.appendChild(historyItemDiv);

            });



            promptHistoryContainer.querySelectorAll('.copy-history-btn').forEach(button => {

                button.addEventListener('click', function() {

                    const type = this.dataset.type;

                    const index = parseInt(this.dataset.index);

                    const historyData = JSON.parse(localStorage.getItem(PROMPT_HISTORY_STORAGE_KEY)) || [];

                    if (historyData[index]) {

                        const textToCopy = type === 'indonesian' ? historyData[index].indonesianPrompt : historyData[index].englishPrompt;

                        navigator.clipboard.writeText(textToCopy).then(() => {

                            const originalText = this.textContent;

                            this.textContent = 'Tersalin!';

                            setTimeout(() => { this.textContent = originalText; }, 1500);

                        }).catch(err => console.error('Gagal menyalin dari riwayat:', err));

                    }

                });

            });

        }



        function clearPromptHistory() {

            if (confirm("Apakah Anda yakin ingin menghapus semua riwayat prompt?")) {

                localStorage.removeItem(PROMPT_HISTORY_STORAGE_KEY);

                loadPromptHistory();

            }

        }

        

        function updatePromptOutputAreaWithMessage(element, message, isError = false) {

            const colorClass = isError ? 'text-red-500 dark:text-red-400' : 'text-gray-500 dark:text-dark-text-secondary';

            const iconHTML = isError ? 

                '<svg class="w-6 h-6 text-red-500 dark:text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' :

                '<div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500 dark:border-purple-400"></div>';

            

            element.innerHTML = `<div class="flex items-center justify-center p-4">

                                    ${iconHTML}

                                    <span class="ml-2 ${colorClass} text-sm">${message}</span>

                                 </div>`;

        }



        // --- Input Validation and Suggestion Function ---

        function validateAndDisplaySuggestions() {

            const outputMediaType = getElementValue('outputMediaType');

            const negativePromptText = getElementValue('negativePrompt');

            const suggestions = [];



            if (outputMediaType === 'video' && negativePromptText && negativePromptText.trim() !== '') {

                suggestions.push("💡 Saran: Negative prompt umumnya lebih efektif untuk output gambar daripada video.");

            }

            if (subject.value.length > 100 || mainAction.value.length > 100) {

                 suggestions.push("⚠️ Peringatan: Subjek atau Aksi Utama terlalu panjang, coba persingkat untuk hasil lebih baik.");

            }



            if (inputSuggestionsDiv) {

                if (suggestions.length > 0) {

                    inputSuggestionsDiv.innerHTML = suggestions.map(s => `<p>${s}</p>`).join('');

                    inputSuggestionsDiv.classList.remove('hidden');

                } else {

                    inputSuggestionsDiv.innerHTML = '<p class="italic">Tidak ada saran saat ini.</p>'; // Default message

                    // inputSuggestionsDiv.classList.add('hidden'); // Atau biarkan dengan pesan default

                }

            }

        }





        async function generatePromptLogic() {

            const currentApiKey = getApiKey();

            if (!currentApiKey) {

                alert("Harap setup API Key Gemini Anda terlebih dahulu untuk membuat prompt.");

                document.getElementById('apiKeyModal').classList.add('active');

                return;

            }



            validateAndDisplaySuggestions(); // Call validation



            const generatedPromptDiv = document.getElementById('generatedPrompt');

            const generatedPromptEnglishDiv = document.getElementById('generatedPromptEnglish');

            

            updatePromptOutputAreaWithMessage(generatedPromptDiv, "Memulai pembuatan prompt...");

            generatedPromptEnglishDiv.innerHTML = `<p class="text-gray-500 dark:text-dark-text-secondary">Menunggu prompt Bahasa Indonesia...</p>`;



            try {

                const getVal = (id, customInputSelector, defaultValIfEmpty = '') => {

                    let val = getElementValue(id);

                    if (val === 'custom' && customInputSelector) { 

                        val = getCustomInputValue(customInputSelector, ''); 

                    } else if (val === 'multi_person') { 

                        return 'multi_person'; 

                    }

                    return val || defaultValIfEmpty; 

                };



                const subject = getElementValue('subject');

                const mainAction = getElementValue('mainAction'); 

                const promptPurpose = getVal('promptPurpose', '#customPromptPurposeInput input');

                const outputMediaType = getElementValue('outputMediaType');



                if (!subject.trim() || !mainAction.trim()) {

                    alert("Field 'Subjek Utama' dan 'Aksi Utama Subjek' wajib diisi.");

                    updatePromptOutputAreaWithMessage(generatedPromptDiv, "Field Subjek Utama dan Aksi Utama Subjek wajib diisi.", true);

                    return;

                }

                

                updatePromptOutputAreaWithMessage(generatedPromptDiv, "Membuat prompt dasar dengan AI...");

                const refinementResult = await promptHandler.refinePrompt(subject, mainAction, currentApiKey, promptPurpose, outputMediaType);

                let basePromptIndonesia;



                if (refinementResult.success) {

                    basePromptIndonesia = refinementResult.data;

                } else {

                    updatePromptOutputAreaWithMessage(generatedPromptDiv, `Gagal membuat prompt dasar: ${refinementResult.error} (Model: ${refinementResult.usedModel || 'tidak diketahui'})`, true);

                    generatedPromptEnglishDiv.innerHTML = `<p class="text-red-500 dark:text-red-400">Menunggu prompt Bahasa Indonesia yang berhasil...</p>`;

                    return;

                }



                const subjectCharacteristics = getVal('subjectCharacteristics', '#customSubjectCharacteristicsInput input');

                const emotion = getVal('emotion', '#customEmotionInput input');

                const location = getVal('location', '#customLocationInput input');

                const time = getVal('time', '#customTimeInput input');

                const weather = getVal('weather', '#customWeatherInput input');

                

                const style = getVal('style', '#customStyleInput input');

                const cameraMovement = getVal('cameraMovement', '#customCameraMovementInput input');

                const cameraAngle = getVal('cameraAngle', '#customCameraAngleInput input');

                const focalLength = getVal('focalLength', '#customFocalLengthInput input');

                const lighting = getVal('lighting', '#customLightingInput input');

                const colorGrading = getVal('colorGrading', '#customColorGradingInput input');

                

                let dialogTextValue = dialogSelect.value; 

                let processedDialogContentForPrompt = ""; 

                let dialogProcessingMessages = []; 



                if (dialogTextValue === 'custom') {

                    dialogProcessingMessages.push("Memproses dialog manual...");

                    updatePromptOutputAreaWithMessage(generatedPromptDiv, dialogProcessingMessages.join("<br>"));

                    const customDialogText = customDialogInputDiv.querySelector('.custom-dialog-text-input').value.trim();

                    let lang = customDialogLanguageSelect.value;

                    if (lang === 'Bahasa Lainnya') {

                        lang = customDialogLanguageOtherInput.value.trim() || 'Bahasa Lainnya';

                    }



                    if (customDialogText) {

                        if (lang !== "Bahasa Indonesia" && lang !== "English" && lang.trim() !== "" && lang !== "Bahasa Lainnya (Sebutkan)") {

                            dialogProcessingMessages.push(`Menerjemahkan dialog manual ke ${lang}...`);

                            updatePromptOutputAreaWithMessage(generatedPromptDiv, dialogProcessingMessages.join("<br>"));

                            

                            const regionalTranslationResult = await promptHandler.translateDialogLine(customDialogText, lang, currentApiKey);

                            if (regionalTranslationResult.success) {

                                processedDialogContentForPrompt = `(${lang}): "${regionalTranslationResult.data}"`;

                                dialogProcessingMessages.push(`Dialog manual berhasil diterjemahkan ke ${lang}.`);

                            } else {

                                processedDialogContentForPrompt = `(${lang}, Gagal Terjemahan): "${customDialogText}"`; 

                                dialogProcessingMessages.push(`Gagal menerjemahkan dialog manual ke ${lang}. Menggunakan teks asli.`);

                                showToast(`Gagal menerjemahkan dialog ke ${lang}: ${regionalTranslationResult.error}`, 5000);

                            }

                        } else {

                             processedDialogContentForPrompt = `(${lang === "Bahasa Lainnya (Sebutkan)" || lang === "" ? "Bahasa Indonesia" : lang}): "${customDialogText}"`;

                        }

                    }

                } else if (dialogTextValue === 'multi_person') {

                    dialogProcessingMessages.push("Memproses dialog multi-orang...");

                    updatePromptOutputAreaWithMessage(generatedPromptDiv, dialogProcessingMessages.join("<br>"));

                    const speakerEntries = multiPersonDialogContainer.querySelectorAll('.speaker-entry');

                    let multiDialogParts = [];

                    

                    for (let i = 0; i < speakerEntries.length; i++) {

                        const entry = speakerEntries[i];

                        const name = entry.querySelector('.speaker-name').value.trim();

                        const dialogText = entry.querySelector('.speaker-dialog').value.trim();

                        let lang = entry.querySelector('.speaker-dialog-language').value;

                        if (lang === 'Bahasa Lainnya') {

                            lang = entry.querySelector('.speaker-dialog-language-other').value.trim() || 'Bahasa Lainnya';

                        }



                        if (dialogText) {

                            let currentLine = "";

                            let speakerDisplayName = name || `Pembicara ${i+1}`;

                            if (lang !== "Bahasa Indonesia" && lang !== "English" && lang.trim() !== "" && lang !== "Bahasa Lainnya (Sebutkan)") {

                                dialogProcessingMessages.push(`Menerjemahkan dialog ${speakerDisplayName} ke ${lang}...`);

                                updatePromptOutputAreaWithMessage(generatedPromptDiv, dialogProcessingMessages.join("<br>"));



                                const regionalTranslationResult = await promptHandler.translateDialogLine(dialogText, lang, currentApiKey);

                                if (regionalTranslationResult.success) {

                                    currentLine = `${name ? name + ' ' : ''}(${lang}): "${regionalTranslationResult.data}"`;

                                    dialogProcessingMessages.push(`Dialog ${speakerDisplayName} berhasil diterjemahkan ke ${lang}.`);

                                } else {

                                    currentLine = `${name ? name + ' ' : ''}(${lang}, Gagal Terjemahan): "${dialogText}"`;

                                    dialogProcessingMessages.push(`Gagal menerjemahkan dialog ${speakerDisplayName} ke ${lang}. Menggunakan teks asli.`);

                                    showToast(`Gagal menerjemahkan dialog untuk ${speakerDisplayName} ke ${lang}: ${regionalTranslationResult.error}`, 5000);

                                }

                            } else {

                                currentLine = `${name ? name + ' ' : ''}(${lang === "Bahasa Lainnya (Sebutkan)" || lang === "" ? "Bahasa Indonesia" : lang}): "${dialogText}"`;

                            }

                            multiDialogParts.push(currentLine);

                        }

                    }

                    processedDialogContentForPrompt = multiDialogParts.join('; ');

                    if (speakerEntries.length > 0) dialogProcessingMessages.push("Semua dialog multi-orang diproses.");

                } else if (dialogTextValue !== 'none') { 

                    processedDialogContentForPrompt = dialogTextValue; 

                }

                if(dialogProcessingMessages.length > 0) updatePromptOutputAreaWithMessage(generatedPromptDiv, dialogProcessingMessages.join("<br>") + "<br>Menyusun prompt akhir...");





                const backgroundMusicText = getVal('backgroundMusic', '#customMusicInput input');

                const soundEffectsText = getVal('soundEffects', '#customSoundEffectsInput input');

                const audioTranslation = getElementValue('audioTranslation'); 

                const videoQuality = getElementValue('videoQuality'); 

                const additionalDetails = getElementValue('additionalDetails');

                const negativePromptText = getElementValue('negativePrompt'); // Get negative prompt

                const showAudioMixing = document.getElementById('showAudioMixing').value === 'true';

                const dialogVolume = showAudioMixing ? getElementValue('dialogVolume', '80') : null;

                const musicVolume = showAudioMixing ? getElementValue('musicVolume', '60') : null;

                const effectsVolume = showAudioMixing ? getElementValue('effectsVolume', '40') : null; 

                const overallMasterVolume = showAudioMixing ? getElementValue('overallVolume', '100') : null;



                let finalPromptIndonesia = basePromptIndonesia;

                let optionalDetailsArray = [];

                if (subjectCharacteristics && subjectCharacteristics.trim() !== '' && subjectCharacteristics.trim() !== 'Tidak Ada Karakteristik Spesifik') optionalDetailsArray.push(`Karakteristik subjek: ${subjectCharacteristics}`);

                if (emotion && emotion.trim() !== '' && emotion.trim() !== 'Tidak Ada Emosi Spesifik') optionalDetailsArray.push(`Emosi yang ditonjolkan: ${emotion}`);

                if (location && location.trim() !== '' && location.trim() !== 'Tidak Ada Lokasi Spesifik') optionalDetailsArray.push(`Berlokasi di ${location}`);

                if (time && time.trim() !== '' && time.trim() !== 'Tidak Ada Waktu Spesifik') optionalDetailsArray.push(`Pada waktu ${time}`);

                if (weather && weather.trim() !== '' && weather.trim() !== 'Tidak Ada Cuaca Spesifik') optionalDetailsArray.push(`Dengan cuaca ${weather}`);

                

                if (style && style.trim() !== '' && style.trim() !== 'Biarkan AI Memilih') optionalDetailsArray.push(`Gaya visual tambahan: ${style}`);

                if (cameraMovement && cameraMovement.trim() !== '' && cameraMovement.trim() !== 'Biarkan AI Memilih') optionalDetailsArray.push(`Pergerakan kamera tambahan: ${cameraMovement}`);

                if (cameraAngle && cameraAngle.trim() !== '' && cameraAngle.trim() !== 'Biarkan AI Memilih') optionalDetailsArray.push(`Sudut kamera tambahan: ${cameraAngle}`);

                if (focalLength && focalLength.trim() !== '' && focalLength.trim() !== 'Biarkan AI Memilih') optionalDetailsArray.push(`Panjang fokus tambahan: ${focalLength}`);

                if (lighting && lighting.trim() !== '' && lighting.trim() !== 'Biarkan AI Memilih') optionalDetailsArray.push(`Pencahayaan tambahan: ${lighting}`);

                if (colorGrading && colorGrading.trim() !== '' && colorGrading.trim() !== 'Biarkan AI Memilih') optionalDetailsArray.push(`Gradiasi warna tambahan: ${colorGrading}`);



                if (optionalDetailsArray.length > 0) {

                    finalPromptIndonesia += `\n\nDetail Tambahan Spesifik: ${optionalDetailsArray.join('. ')}.`;

                }

                

                let audioDescriptionPartsIndo = [];

                 if (processedDialogContentForPrompt && processedDialogContentForPrompt.trim() !== '') { 

                    let currentDialogText = `Dialog: ${processedDialogContentForPrompt}`; 

                    if (dialogVolume && showAudioMixing) currentDialogText += ` (Volume: ${dialogVolume}%)`;

                    audioDescriptionPartsIndo.push(currentDialogText);

                }

                if (backgroundMusicText && backgroundMusicText !== 'none' && backgroundMusicText.trim() !== '') {

                    let currentMusicText = `Musik Latar: ${backgroundMusicText}`;

                    if (musicVolume && showAudioMixing) currentMusicText += ` (Volume: ${musicVolume}%)`;

                    audioDescriptionPartsIndo.push(currentMusicText);

                }

                if (soundEffectsText && soundEffectsText !== 'none' && soundEffectsText.trim() !== '') {

                    let currentEffectsText = `Efek Suara: ${soundEffectsText}`;

                    if (effectsVolume && showAudioMixing) currentEffectsText += ` (Volume: ${effectsVolume}%)`;

                    audioDescriptionPartsIndo.push(currentEffectsText);

                }

                 if(audioTranslation && audioTranslation !== 'none'){ 

                       audioDescriptionPartsIndo.push(`Terjemahan Audio: ${audioTranslation}`);

                }

                 if (overallMasterVolume && showAudioMixing && audioDescriptionPartsIndo.length > 0) { 

                    audioDescriptionPartsIndo.push(`Volume Master Audio: ${overallMasterVolume}%.`);

                }





                if (audioDescriptionPartsIndo.length > 0) {

                    finalPromptIndonesia += `\n\nAudio: ${audioDescriptionPartsIndo.join(', ')}.`;

                }

                

                finalPromptIndonesia += `\n\nKualitas Output: ${videoQuality || 'HD (16:9)'}.`; 



                if (additionalDetails && additionalDetails.trim() !== '') {

                    finalPromptIndonesia += `\n\nCatatan Tambahan Penting: ${additionalDetails}`;

                }



                if (negativePromptText && negativePromptText.trim() !== '') { // Add negative prompt to Indonesian

                    finalPromptIndonesia += `\n\nNegative Prompt (Hindari): ${negativePromptText}`;

                }





                generatedPromptDiv.innerHTML = `<p class="text-gray-800 dark:text-dark-text whitespace-pre-line">${finalPromptIndonesia}</p>`;

                

                // --- English Prompt Generation ---

                updatePromptOutputAreaWithMessage(generatedPromptEnglishDiv, "Menerjemahkan prompt ke Bahasa Inggris (mempertahankan bahasa dialog)...");

                

                let promptPartsToTranslate = [basePromptIndonesia];

                if (optionalDetailsArray.length > 0) {

                    promptPartsToTranslate.push(`Detail Tambahan Spesifik: ${optionalDetailsArray.join('. ')}.`);

                }



                let descriptiveAudioPartsForEng = [];

                if (backgroundMusicText && backgroundMusicText !== 'none' && backgroundMusicText.trim() !== '') {

                    let musicText = `Musik Latar: ${backgroundMusicText}`;

                    if (musicVolume && showAudioMixing) musicText += ` (Volume: ${musicVolume}%)`;

                    descriptiveAudioPartsForEng.push(musicText);

                }

                if (soundEffectsText && soundEffectsText !== 'none' && soundEffectsText.trim() !== '') {

                    let sfxText = `Efek Suara: ${soundEffectsText}`;

                    if (effectsVolume && showAudioMixing) sfxText += ` (Volume: ${effectsVolume}%)`;

                    descriptiveAudioPartsForEng.push(sfxText);

                }

                 if(audioTranslation && audioTranslation !== 'none'){ 

                       descriptiveAudioPartsForEng.push(`Terjemahan Audio: ${audioTranslation}`);

                }

                if (overallMasterVolume && showAudioMixing && (processedDialogContentForPrompt || descriptiveAudioPartsForEng.length > 0)) {

                    descriptiveAudioPartsForEng.push(`Volume Master Audio: ${overallMasterVolume}%.`);

                }

                

                if (descriptiveAudioPartsForEng.length > 0) {

                    promptPartsToTranslate.push(`Audio (deskriptif): ${descriptiveAudioPartsForEng.join(', ')}.`);

                }



                promptPartsToTranslate.push(`Kualitas Output: ${videoQuality || 'HD (16:9)'}.`);

                if (additionalDetails && additionalDetails.trim() !== '') {

                    promptPartsToTranslate.push(`Catatan Tambahan Penting: ${additionalDetails}`);

                }

                // Add negative prompt for translation if it exists

                if (negativePromptText && negativePromptText.trim() !== '') {

                    promptPartsToTranslate.push(`Negative Prompt (Hindari): ${negativePromptText}`);

                }





                const textToTranslateToEnglish = promptPartsToTranslate.join('\n\n');

                const mainTranslationResult = await promptHandler.translateText(textToTranslateToEnglish, currentApiKey);

                let translatedMainPart = "";



                if (!mainTranslationResult.success) {

                    updatePromptOutputAreaWithMessage(generatedPromptEnglishDiv, `Gagal menerjemahkan bagian utama prompt: ${mainTranslationResult.error}`, true);

                    translatedMainPart = textToTranslateToEnglish + " (Translation to English Failed)"; // Fallback

                } else {

                    translatedMainPart = mainTranslationResult.data;

                }

                

                let finalEnglishPrompt = translatedMainPart;



                if (processedDialogContentForPrompt && processedDialogContentForPrompt.trim() !== '') {

                    let dialogSegmentForEnglish = `Dialog: ${processedDialogContentForPrompt}`;

                    if (dialogVolume && showAudioMixing) dialogSegmentForEnglish += ` (Volume: ${dialogVolume}%)`;



                    const audioMarkerTranslatedSearch = "Audio (descriptive):"; 

                    const audioMarkerGenericTranslatedSearch = "Audio:";

                    

                    let audioSectionExistsInEnglish = false;

                    let tempFinalEnglishPrompt = finalEnglishPrompt;



                    let fullAudioBlockForEnglish = [dialogSegmentForEnglish];

                    if (descriptiveAudioPartsForEng.length > 0) {

                        // Attempt to find the translated descriptive audio part within finalEnglishPrompt

                        // This is tricky because the exact wording after translation can vary.

                        // We'll look for a generic "Audio:" marker or the translated "Audio (descriptive):"

                        let translatedDescriptiveAudioText = "";

                        const descAudioIndoForMarker = `Audio (deskriptif): ${descriptiveAudioPartsForEng.join(', ')}.`;

                        const descAudioTransResultForMarker = await promptHandler.translateText(descAudioIndoForMarker, currentApiKey);

                        if(descAudioTransResultForMarker.success) {

                            // Extract just the descriptive part from the translated block

                            translatedDescriptiveAudioText = descAudioTransResultForMarker.data.replace(/^Audio \(descriptive\):\s*/i, '').replace(/^Audio:\s*/i, '');

                        } else {

                            translatedDescriptiveAudioText = descriptiveAudioPartsForEng.join(', ') + " (Translation Failed)";

                        }

                        if (translatedDescriptiveAudioText) {

                            fullAudioBlockForEnglish.push(translatedDescriptiveAudioText);

                        }

                    }

                    

                    const combinedAudioStringForEnglish = fullAudioBlockForEnglish.join(', ');



                    // Try to replace existing audio section, or append

                    const translatedAudioMarker = (await promptHandler.translateText("Audio (deskriptif):", currentApiKey)).data || audioMarkerTranslatedSearch;

                    const translatedGenericAudioMarker = (await promptHandler.translateText("Audio:", currentApiKey)).data || audioMarkerGenericTranslatedSearch;



                    let replaced = false;

                    if (tempFinalEnglishPrompt.includes(translatedAudioMarker)) {

                        tempFinalEnglishPrompt = tempFinalEnglishPrompt.replace(new RegExp(translatedAudioMarker.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ".*?(?=\\n\\n|$)", "s"), `Audio: ${combinedAudioStringForEnglish}.`);

                        replaced = true;

                    } else if (tempFinalEnglishPrompt.includes(translatedGenericAudioMarker)) {

                         tempFinalEnglishPrompt = tempFinalEnglishPrompt.replace(new RegExp(translatedGenericAudioMarker.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ".*?(?=\\n\\n|$)", "s"), `Audio: ${combinedAudioStringForEnglish}.`);

                         replaced = true;

                    }



                    if (!replaced) { 

                        tempFinalEnglishPrompt += `\n\nAudio: ${combinedAudioStringForEnglish}.`;

                    }

                    finalEnglishPrompt = tempFinalEnglishPrompt;

                }





                generatedPromptEnglishDiv.innerHTML = `<p class="text-gray-800 dark:text-dark-text whitespace-pre-line">${finalEnglishPrompt.trim()}</p>`;

                savePromptToHistory(finalPromptIndonesia, finalEnglishPrompt.trim());



            } catch (error) {

                console.error('Error dalam generatePromptLogic:', error);

                updatePromptOutputAreaWithMessage(generatedPromptDiv, `Error: ${error.message}`, true);

                updatePromptOutputAreaWithMessage(generatedPromptEnglishDiv, "Gagal memproses.", true);

            }

        }

        

        function setupCopyButtons() { document.querySelectorAll('.copy-btn-output').forEach(button => { button.addEventListener('click', async function() { const targetId = this.getAttribute('data-target'); const textElement = document.getElementById(targetId); if (!textElement) return; const textToCopy = textElement.innerText || textElement.textContent; const originalButtonHTML = this.innerHTML; try { await navigator.clipboard.writeText(textToCopy); this.innerHTML = `<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg><span class="ml-1">${this.textContent.trim().includes('Salin') ? 'Tersalin!' : 'Copied!'}</span>`; this.classList.add('text-green-600', 'border-green-400', 'bg-green-50'); this.classList.remove('text-blue-600', 'border-blue-200', 'hover:bg-blue-50', 'text-red-500', 'border-red-400'); } catch (err) { console.warn('navigator.clipboard.writeText failed, trying execCommand:', err); const textArea = document.createElement("textarea"); textArea.value = textToCopy; textArea.style.position = "fixed"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); this.innerHTML = `<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg><span class="ml-1">${this.textContent.trim().includes('Salin') ? 'Tersalin!' : 'Copied!'}</span>`; this.classList.add('text-green-600', 'border-green-400', 'bg-green-50'); this.classList.remove('text-blue-600', 'border-blue-200', 'hover:bg-blue-50', 'text-red-500', 'border-red-400'); } catch (execErr) { console.error('Failed to copy with execCommand: ', execErr); this.innerHTML = 'Gagal Salin'; this.classList.add('text-red-500', 'border-red-400'); this.classList.remove('text-green-600', 'border-green-400', 'bg-green-50', 'text-blue-600', 'border-blue-200', 'hover:bg-blue-50'); } document.body.removeChild(textArea); } finally { setTimeout(() => { this.innerHTML = originalButtonHTML; this.classList.remove('text-green-600', 'border-green-400', 'bg-green-50', 'text-red-500', 'border-red-400'); if (this.textContent.trim().includes('Salin')) { this.classList.add('text-blue-600', 'border-blue-200', 'hover:bg-blue-50'); } else if (this.textContent.trim().includes('Copy')) { this.classList.add('text-green-600', 'border-green-200', 'hover:bg-green-50'); } }, 2000); } }); }); }

        const fieldsWithCustomInput = [ 

            'promptPurpose', 'subjectCharacteristics', 'emotion', 'location', 'time', 'weather', 'season', 

            'style', 'cameraMovement', 'cameraAngle', 'focalLength', 'lighting', 'colorGrading',

            'dialog', 'backgroundMusic', 'soundEffects'

        ];



        function addInputListeners() {

            fieldsWithCustomInput.forEach(id => { 

                const select = document.getElementById(id); 

                const customInputDivId = `custom${id.charAt(0).toUpperCase() + id.slice(1)}Input`; 

                const customInputDiv = document.getElementById(customInputDivId); 

                if (select && customInputDiv) { 

                    select.addEventListener('change', function() { 

                        if (id === 'dialog') {

                            customDialogInputDiv.classList.toggle('hidden', this.value !== 'custom');

                            multiPersonDialogContainer.classList.toggle('hidden', this.value !== 'multi_person');

                            

                            if (this.value !== 'custom') {

                                customDialogInputDiv.querySelector('.custom-dialog-text-input').value = '';

                                customDialogLanguageSelect.value = 'Bahasa Indonesia';

                                customDialogLanguageOtherInput.classList.add('hidden');

                                customDialogLanguageOtherInput.value = '';

                            }

                            if (this.value !== 'multi_person') {

                                multiPersonDialogContainer.querySelectorAll('.speaker-entry').forEach(e => e.remove());

                            }

                        } else {

                             customInputDiv.classList.toggle('hidden', this.value !== 'custom'); 

                             if(this.value !== 'custom') { 

                                 const inputField = customInputDiv.querySelector('input'); 

                                 if(inputField) inputField.value = ''; 

                             } 

                        }

                    }); 

                } 

            });

            

            if (dialogSelect) { 

                dialogSelect.addEventListener('change', function() {

                    customDialogInputDiv.classList.toggle('hidden', this.value !== 'custom');

                    multiPersonDialogContainer.classList.toggle('hidden', this.value !== 'multi_person');

                    if (this.value !== 'custom') {

                        customDialogInputDiv.querySelector('.custom-dialog-text-input').value = '';

                        customDialogLanguageSelect.value = 'Bahasa Indonesia';

                        customDialogLanguageOtherInput.classList.add('hidden');

                        customDialogLanguageOtherInput.value = '';

                    }

                    if (this.value !== 'multi_person') {

                         multiPersonDialogContainer.querySelectorAll('.speaker-entry').forEach(e => e.remove()); 

                    }

                });

            }



            if (customDialogLanguageSelect) {

                customDialogLanguageSelect.addEventListener('change', function() {

                    customDialogLanguageOtherInput.classList.toggle('hidden', this.value !== 'Bahasa Lainnya');

                    if (this.value !== 'Bahasa Lainnya') {

                        customDialogLanguageOtherInput.value = '';

                    }

                });

            }





            if (addSpeakerButton) {

                addSpeakerButton.addEventListener('click', addSpeakerEntry);

            }

            

            const promptForm = document.getElementById('promptForm');

            if (promptForm) {

                promptForm.addEventListener('submit', function(e) {

                    e.preventDefault();

                    generatePromptLogic();

                });

            }



            if (regeneratePromptButton) { 

                regeneratePromptButton.addEventListener('click', function() {

                    generatePromptLogic(); 

                });

            }

            if (clearHistoryButton) {

                clearHistoryButton.addEventListener('click', clearPromptHistory);

            }



            // Dark Mode Toggle Listener

            if (darkModeToggle) {

                darkModeToggle.addEventListener('click', toggleDarkMode);

            }

        }

        

        document.getElementById('resetButton')?.addEventListener('click', () => { 

            document.getElementById('promptForm').reset(); 

            fieldsWithCustomInput.forEach(id => { 

                const customInputDivId = `custom${id.charAt(0).toUpperCase() + id.slice(1)}Input`; 

                const customInputDiv = document.getElementById(customInputDivId);

                if (customInputDiv) customInputDiv.classList.add('hidden'); 

                

                const selectField = document.getElementById(id); 

                if (selectField && selectField.options.length > 0) { 

                    let defaultIndex = 0;

                    for(let i=0; i < selectField.options.length; i++) {

                        if(selectField.options[i].value && 

                           selectField.options[i].value !== 'custom' &&

                           selectField.options[i].value !== 'multi_person') { 

                            defaultIndex = i;

                            break;

                        }

                    }

                    selectField.selectedIndex = defaultIndex;

                    if (id === 'dialog') {

                         const event = new Event('change');

                         selectField.dispatchEvent(event); 

                    }

                }

            }); 

            const promptPurposeSelect = document.getElementById('promptPurpose');

            if(promptPurposeSelect) promptPurposeSelect.value = "video_sinematik";

            const outputMediaTypeSelect = document.getElementById('outputMediaType');

            if(outputMediaTypeSelect) outputMediaTypeSelect.value = "video";



            if (multiPersonDialogContainer) {

                multiPersonDialogContainer.classList.add('hidden');

                multiPersonDialogContainer.querySelectorAll('.speaker-entry').forEach(e => e.remove());

            }

             if (customDialogInputDiv) { 

                customDialogInputDiv.classList.add('hidden');

                customDialogInputDiv.querySelector('.custom-dialog-text-input').value = '';

                customDialogLanguageSelect.value = 'Bahasa Indonesia';

                customDialogLanguageOtherInput.classList.add('hidden');

                customDialogLanguageOtherInput.value = '';

            }

            if (inputSuggestionsDiv) inputSuggestionsDiv.innerHTML = '<p class="italic">Tidak ada saran saat ini.</p>';





            updateVolumeDisplay('dialogVolume', 'dialogVolumeValue'); 

            updateVolumeDisplay('musicVolume', 'musicVolumeValue'); 

            updateVolumeDisplay('effectsVolume', 'effectsVolumeValue'); 

            updateVolumeDisplay('overallVolume', 'overallVolumeValue'); 

            const audioMixingContent = document.getElementById('audioMixingContent'); 

            if (audioMixingContent && !audioMixingContent.classList.contains('hidden')) { 

                document.getElementById('audioMixingChevron').classList.remove('rotate-180'); 

                audioMixingContent.classList.add('hidden'); 

                document.getElementById('showAudioMixing').value = 'false'; 

            } 

            const genPromptDiv = document.getElementById('generatedPrompt'); 

            const genPromptEngDiv = document.getElementById('generatedPromptEnglish'); 

            if(genPromptDiv) genPromptDiv.innerHTML = '<p class="text-gray-500 dark:text-dark-text-secondary">Prompt Bahasa Indonesia akan muncul di sini...</p>'; 

            if(genPromptEngDiv) genPromptEngDiv.innerHTML = '<p class="text-gray-500 dark:text-dark-text-secondary">Professional English prompt will appear here...</p>'; 

        });

        document.getElementById('clearPromptButton')?.addEventListener('click', () => { const genPromptDiv = document.getElementById('generatedPrompt'); const genPromptEngDiv = document.getElementById('generatedPromptEnglish'); if(genPromptDiv) genPromptDiv.innerHTML = '<p class="text-gray-500 dark:text-dark-text-secondary">Prompt Bahasa Indonesia akan muncul di sini...</p>'; if(genPromptEngDiv) genPromptEngDiv.innerHTML = '<p class="text-gray-500 dark:text-dark-text-secondary">Professional English prompt will appear here...</p>'; });



        const setupApiKeyButton = document.getElementById('setupApiKeyButton');

        const apiKeyModal = document.getElementById('apiKeyModal');

        const closeApiKeyModalButton = document.getElementById('closeApiKeyModal');

        const saveApiKeyButton = document.getElementById('saveApiKeyButton');

        const geminiApiKeyInput = document.getElementById('geminiApiKeyInput'); 

        const apiKeySuccessMessage = document.getElementById('apiKeySuccessMessage');

        const apiKeyErrorMessage = document.getElementById('apiKeyErrorMessage');





        if (setupApiKeyButton && apiKeyModal && closeApiKeyModalButton && saveApiKeyButton) {

            setupApiKeyButton.addEventListener('click', () => {

                geminiApiKeyInput.value = getApiKey() || ''; 

                apiKeyModal.classList.add('active');

            });

            closeApiKeyModalButton.addEventListener('click', () => {

                apiKeyModal.classList.remove('active');

                apiKeySuccessMessage.classList.add('hidden');

                apiKeyErrorMessage.classList.add('hidden');

            });

            apiKeyModal.addEventListener('click', (event) => { 

                if (event.target === apiKeyModal) {

                    apiKeyModal.classList.remove('active');

                    apiKeySuccessMessage.classList.add('hidden');

                    apiKeyErrorMessage.classList.add('hidden');

                }

            });

            saveApiKeyButton.addEventListener('click', async () => {

                const apiKey = geminiApiKeyInput.value.trim();

                if (apiKey) {

                    saveApiKey(apiKey, "pribadi"); 

                    apiKeySuccessMessage.classList.remove('hidden');

                    apiKeyErrorMessage.classList.add('hidden');

                    setTimeout(() => {

                        apiKeyModal.classList.remove('active');

                    }, 1500);

                } else {

                    apiKeyErrorMessage.textContent = "API Key tidak boleh kosong.";

                    apiKeyErrorMessage.classList.remove('hidden');

                    apiKeySuccessMessage.classList.add('hidden');

                }

            });

        }

        

        if (copySharedApiKeyButton && sharedApiKeyDisplay) {

            copySharedApiKeyButton.addEventListener('click', async () => {

                const sharedKey = sharedApiKeyDisplay.value;

                const originalButtonText = copySharedApiKeyButton.innerHTML;

                const originalButtonClasses = [...copySharedApiKeyButton.classList]; 



                const textArea = document.createElement("textarea");

                textArea.value = sharedKey;

                textArea.style.position = "fixed"; 

                textArea.style.left = "-9999px"; 

                document.body.appendChild(textArea);

                textArea.focus();

                textArea.select();

                try {

                    document.execCommand('copy');

                    copySharedApiKeyButton.innerHTML = `

                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>

                        Tersalin!`;

                    copySharedApiKeyButton.classList.remove('bg-purple-600', 'hover:bg-purple-700');

                    copySharedApiKeyButton.classList.add('bg-green-500', 'hover:bg-green-600');

                    alert("API Key Gratis telah disalin! Silakan buka 'Setup API Key Pribadi' dan tempel (paste) di sana untuk menggunakannya.");

                } catch (err) {

                    console.error('Gagal menyalin API Key gratis dengan execCommand: ', err);

                    copySharedApiKeyButton.innerHTML = 'Gagal Salin';

                    copySharedApiKeyButton.classList.remove('bg-purple-600', 'hover:bg-purple-700');

                    copySharedApiKeyButton.classList.add('bg-red-500', 'hover:bg-red-600');

                    alert("Gagal menyalin API Key. Coba lagi secara manual.");

                } finally {

                    document.body.removeChild(textArea);

                    setTimeout(() => {

                        copySharedApiKeyButton.innerHTML = originalButtonText;

                        copySharedApiKeyButton.className = ''; 

                        originalButtonClasses.forEach(cls => copySharedApiKeyButton.classList.add(cls));

                    }, 2500);

                }

            });

        }



        // --- Dark Mode Functions ---

        function applyDarkMode(isDark) {

            if (isDark) {

                document.documentElement.classList.add('dark');

                if(sunIcon) sunIcon.classList.add('hidden');

                if(moonIcon) moonIcon.classList.remove('hidden');

            } else {

                document.documentElement.classList.remove('dark');

                if(sunIcon) sunIcon.classList.remove('hidden');

                if(moonIcon) moonIcon.classList.add('hidden');

            }

        }



        function toggleDarkMode() {

            const isDark = document.documentElement.classList.toggle('dark');

            localStorage.setItem(DARK_MODE_STORAGE_KEY, isDark);

            applyDarkMode(isDark);

        }





        document.addEventListener('DOMContentLoaded', async function() {

            addInputListeners();

            setupCopyButtons();

            loadPromptHistory(); 

            

            // Initialize Dark Mode

            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

            const storedDarkMode = localStorage.getItem(DARK_MODE_STORAGE_KEY);

            if (storedDarkMode === 'true') {

                applyDarkMode(true);

            } else if (storedDarkMode === 'false') {

                applyDarkMode(false);

            } else { // No preference stored, use system preference

                applyDarkMode(prefersDark);

            }

            

            updateVolumeDisplay('dialogVolume', 'dialogVolumeValue');

            updateVolumeDisplay('musicVolume', 'musicVolumeValue');

            updateVolumeDisplay('effectsVolume', 'effectsVolumeValue');

            updateVolumeDisplay('overallVolume', 'overallVolumeValue');

            

            fieldsWithCustomInput.forEach(id => { 

                const select = document.getElementById(id); 

                const customInputDivId = `custom${id.charAt(0).toUpperCase() + id.slice(1)}Input`; 

                const customInputDiv = document.getElementById(customInputDivId); 

                if (select && customInputDiv) { 

                    if (id === 'dialog') {

                        customInputDiv.classList.toggle('hidden', select.value !== 'custom');

                        multiPersonDialogContainer.classList.toggle('hidden', select.value !== 'multi_person');

                    } else {

                        customInputDiv.classList.toggle('hidden', select.value !== 'custom'); 

                    }

                } 

            });



            updateApiKeyStatusUI(!!getApiKey(), getApiKeyType()); 

            if (inputSuggestionsDiv) inputSuggestionsDiv.innerHTML = '<p class="italic">Tidak ada saran saat ini.</p>';





            const genPromptDiv = document.getElementById('generatedPrompt'); 

            const genPromptEngDiv = document.getElementById('generatedPromptEnglish'); 

            if(genPromptDiv) genPromptDiv.innerHTML = '<p class="text-gray-500 dark:text-dark-text-secondary">Silakan atur API Key Gemini Anda dan klik "Buat Prompt Profesional".</p>'; 

            if(genPromptEngDiv) genPromptEngDiv.innerHTML = '<p class="text-gray-500 dark:text-dark-text-secondary">Please set up your Gemini API Key and click "Buat Prompt Profesional".</p>';

        });



    </script>

</body>

</html>
